{"version":3,"sources":["reportWebVitals.ts","data/data-models.ts","data/demon-compendium.ts","ui-components/data-table.tsx","ui-components/ingredients-table.tsx","ui-components/minor-ui-components.tsx","ui-components/results-table.tsx","ui-components/settings-panel.tsx","ui-components/demon-adder.tsx","ui-components/recipes-table.tsx","demon-displayer.tsx","fusion-calculator.tsx","App.tsx","index.tsx","ui-components/scss/results-table.module.scss","fusion-calculator.module.scss","ui-components/scss/ingredients-table.module.scss","ui-components/scss/recipes-table.module.scss","ui-components/scss/settings-panel.module.scss","ui-components/scss/ui-components.module.scss","demon-displayer.module.scss","ui-components/scss/data-table.module.scss","ui-components/scss/minor-ui-components.module.scss"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","Demon","id","name","lvl","race","stats","specialRecipe","rank","this","statsName","FusedDemon","demon","ingredients","baseIngredientsMetadata","baseIngsMetadata","getBaseIngredientsInfo","baseIngId","count","length","ret","ingId","Object","values","getBaseIngredientsDemons","map","join","DemonsPreset","caption","demons","FusionResults","maxIngredient","data","metadata","ingredientCountMap","size","demonId","hasFusionResult","ingCount","Number","keys","fusedDemons","getBaseIngredientsCounts","species","addNewSpecies","fusedDemon","push","populateFusionResultsIngCountMap","filterFunc","demonAry","filter","existingIngCount","getIngredientCountForSpecies","undefined","Recipe","resultId","ingredientId","baseIngredientCost","sum","recipe","clonedRecipe","FUSION_CHART_NULLS","DemonCompendium","demonListJson","fusionChartJson","fusionSettingsJson","presetJson","demonsAry","normalFusionChart","tripleFusionChart","elementsMap","elementFusionChart","specialRecipes","demonsPresets","_sameRaceFuseToElement","_enableTripleFusion","disableSameDemonFusion","idMap","nameMap","raceIdMap","raceLvlDemonMap","parseDemons","prepDemonIds","parseSettings","parseFusionChart","prepRaceLvlInfo","parsePresets","Models","clone","demonA","demonB","demonIsElement","fuseDemonWithElement","fuseDemonSameRaceNoElement","fuseDemonDiffRaceNoElement","demonC","sort","x","y","getRaceOrder","demonWeak","demonMid","demonStrong","intermediateRace","getFusionRace","resultRace","getTripleFusionRace","resultLvlTable","getLvlTableForRace","resultLvlTest","resultLvl","findResultLvlFromLvlTable","demonResult","getDemonFromRaceLvl","resultLvlIndex","indexOf","demonName","getDemonByName","randomDemonIndex","Math","floor","random","elementsIds","elementsCount","randomElementIdIndex","randomElementId","testGetDemon","results","i","demonR","fuseDemons","console","log","results2","j","tripleFuseDemons","demonsJson","Boolean","sameRaceFuseToElement","enableTripleFusion","row","raceFusionTable","col","dataStructToWriteTo","raceA","races","raceB","raceC","chart","resultName","result","ingredientsNames","ingredientName","ingredient","addIngredient","elements","elementIdIndexMap","elementName","elementFusionTable","raceId","elementId","elementIndex","presetsJson","presets","preset","presetModel","demon1","demon2","includeUnfusable","lvlTable","demonIsUnfusable","lvlToCheck","isTripleFusion","index","raceR","lvlTableR","lvlResultTest","lvlR","elementNameR","element","demonRankChange","resultRank","DataTable","params","maxPage","dataTableProvider","React","useState","page","setPage","sortByCol","setSortByCol","sortDirection","setSortDirection","sortType","setSortType","pageSize","colDefs","getColumnDefinition","preIdRowData","getAllRowsData","totalRowCount","Fragment","banner","renderBanner","ceil","rowData","rd","getSortValue","bind","sortMult","comparitor","numberComparitor","stringComparitor","a","b","valA","valB","paginizedRowData","headerCells","colNum","colDef","headerContent","sortSpec","buildSortableHeaderCellContent","TableCell","headerProps","renderedRows","TableRow","renderRow","paperContainerClassName","styles","paperContainer","className","Paper","elevation","TableContainer","tableContainer","Table","TableHead","header","TableBody","tableBody","Pagination","onChange","event","value","headerInnerContent","colSortType","_sortByCol","_sortDirection","_sortType","TableSortLabel","active","direction","onClick","createSortHandler","setOrderBy","nextSortDirection","IngredientsSettingsEnum","WarningBannerCore","icon","warningBanner","message","WarningBanner","memo","RemoveDemonButton","IconButton","onRemoveIngredient","removeDemonButton","removeDemonButtonIcon","CheckboxSetting","setting","ingredientsSettings","defaultChecked","mustUse","multipleUse","Checkbox","checkBox","checked","target","color","FusionIngredientsDataTableProvider","allRowsData","demonCompendium","nameColumnHeader","raceColumnHeader","width","align","warningIcon","IngredientsTable","initializeIngredientsSettings","useMemo","getDemonById","dataProvider","dataTable","FusionResultsDataTableProvider","onRecipesButtonClick","fusionResults","recipesButtonHandler","columnCount","nameColumn","lvlColumn","raceColumn","statColumn","ingredientsColumn","resultsAsRowsArray","ingCountStr","renderedRow","keyId","stat","getIngredientCount","Button","variant","recipeButton","ResultsTable","props","onOpenDemonRecipes","UserSettings","charLvl","useTripleFusion","useTripleFusionSettingIsVisible","SettingsPanel","eventHandlers","settings","isVisible","setIsVisible","charLvlFieldValue","setCharLvlFieldValue","maxIngFieldValue","setMaxIngFieldValue","toggleVisibility","settingsPanelStyle","height","style","settingsPanel","paper","NumberSettings","label","min","max","emptyFieldValue","fieldStateValueAndSetter","onSetSettings","newValue","CheckboxSettings","stateValueAndSetter","stateValue","stateSetter","settingsLine","numberSettings","numberFieldLabel","TextField","type","InputLabelProps","shrink","inputProps","step","valueAsNumber","FormControlLabel","control","DemonAdder","onAddDemon","presetSection","getDemonPresets","AddByPreset","demonAdderContainer","AddByDemon","AddByLevelRange","selectedDemon","setSelectedDemon","searchOptions","getDemonArray","raiseOnAddDemonEvent","subAdderContainer","Autocomplete","options","selection","onKeyPress","key","getOptionLabel","option","getOptionSelected","autoHighlight","autoSelect","renderInput","AddButton","minLvl","setMinLvl","maxLvl","setMaxLvl","keyIsAccepted","preventDefault","stopPropagation","valueSetterFunc","lvlFieldsContainer","selectedOption","setSelectedOption","addDemonButton","renderDemonName","isFused","baseIngredientName","renderRecipe","priorRecipes","curRecipe","isFirstLoop","ingDemon","separator","nameR","Divider","light","centerText","DemonCard","Card","recipeCard","CardContent","RecipesTable","setFilter","filteredRecipesAry","filterMap","filterOption","recipesAry","filteredAry","ingDemonsCount","filterCheckList","ingDemonId","filterRecipesAry","filterOptions","currFilter","ingDemonsMap","ingDemons","createFilterOptions","componentContainer","multiple","filterField","defaultValue","filterSelectedOptions","pagination","hidden","recipeCardsContainer","DemonDisplayer","demonIdStr","useParams","history","useHistory","isNaN","goBackUrlPath","fusionResultsSection","section","Label","text","promise","Promise","resolver","setTimeout","calculateAllFusionCombinations","userSettings","getSpecialRecipes","viableSpecialRecipes","updateViableSpecialRecipes","ingCountR","ingCountA","ingCountB","speciesUsedAsA","idA","speciesA","idB","speciesB","speciesR","filterDemonsAfterSpeciesFusion","resultingFusedDemons","crissCrossFusedDemons","addFusedDemonsOfSameSpecies","calculateTripleFusionCombinations","calculateSpecialRecipeFusion","mustUseDemons","ingSettings","prepareIngredientsSettingsForFinalFilter","filterFunction","filterDemonsAfterCalculation","ingCountNodeToUpdate","recipeIngCount","getMaxIngredient","registerIngredient","isViable","recipeCost","totalBaseIngredientsCost","ingCounts","getNextCombinationTuple","ingCountC","alreadyCalculatedAsA","alreadyCalculatedAsB","idC","speciesC","resultFusedDemons","currSpecialRecipes","ingredientsSpecies","ingredientsFusedDemons","missingIngredient","ingredientSpecies","ingredientCost","currentTuple","tupleSize","sumRequirement","speciesIngs","canBeMadeWithLessIngredient","sizeCheck","speciesIng","filterDemonsAfterCrissCross","baseIngCount","isWeakerThanBaseIngredients","myMustUseDemons","demonBaseIngCount","resultSpecies","indeces","fusedDemonIngredientsHistory","hasCarry","initializeUserSettings","FusionCalculator","setIngredients","setFusionResults","fusionResultsPromise","setFusionResultsPromise","resetterKey","setResetterKey","routeMatcher","useRouteMatch","nonRenderingStates","settingsPanelEventHandlers","refResultsTable","useRef","useEffect","isMounted","fr","current","scrollIntoView","behavior","removeDemonFromIngredientsHandler","useCallback","newIngredients","path","url","fusionCalculator","loading","addDemonsAndButtonsRowContainer","buttonsRow","calculateButton","calculateAllFusionCombinationsAsync","disabled","settingsButton","resetButton","ref","Backdrop","open","CircularProgress","Game","theme","createMuiTheme","palette","typography","fontFamily","loadPersona4GoldenDemonCompendium","setLoadedCompendiumCallback","demonJsonPromise","importedJson","default","fusionChartJsonPromise","settingsJsonPromise","all","loadedJsons","newDemonCompendium","loadGameData","game","person4Golden","persona5Royal","loadPersona5RoyalDemonCompendium","devilSurvivor2","callback","presetJsonPromise","loadDesu2DemonCompendium","urlParamToGameMap","p4g","p5r","desu2","App","urlParams","setDemonCompendium","currentGame","setCurrentGame","changeGameTabHandler","gameId","gameStrCode","getGameUrlPath","gameFromUrlParam","ThemeProvider","CssBaseline","Tabs","Tab","ReactDOM","render","GitHubPageRedirect","document","getElementById","createBrowserHistory","loc","search","decoded","slice","split","s","replace","window","replaceState","pathname","hash","location","StrictMode","to","module","exports"],"mappings":"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","file":"static/js/main.12761cbb.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","export class Demon {\r\n    id: number = 0;\r\n    name: string;\r\n    lvl: number;\r\n    race: string;\r\n    specialRecipe: boolean = false;\r\n    stats: number[] = [];\r\n    rank?: number;\r\n\r\n    static statsName: string[] = [];\r\n\r\n    constructor(id: number, name: string, lvl: number, race: string, stats: number[]) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.lvl = lvl;\r\n        this.race = race;\r\n        this.stats = stats;\r\n    }\r\n}\r\n\r\nexport class FusedDemon {\r\n    demon: Demon;\r\n    ingredients?: FusedDemon[];\r\n    private baseIngredientsMetadata: { [baseIngId: number]: { count: number, demon: Demon} } = {};\r\n\r\n    constructor(demon: Demon, ingredients?: FusedDemon[]) {\r\n        this.demon = demon;\r\n        this.ingredients = ingredients;\r\n\r\n        if (!ingredients) {\r\n            this.baseIngredientsMetadata[demon.id] = { count: 1, demon: demon};\r\n        } else {\r\n            for (const fusedDemon of ingredients) {\r\n                const baseIngsMetadata = fusedDemon.getBaseIngredientsInfo()\r\n                for (const baseIngId in baseIngsMetadata) {\r\n                    this.baseIngredientsMetadata[baseIngId] = this.baseIngredientsMetadata[baseIngId] || {};\r\n                    this.baseIngredientsMetadata[baseIngId].count =  (this.baseIngredientsMetadata[baseIngId].count || 0 ) + \r\n                        baseIngsMetadata[baseIngId].count;\r\n                    this.baseIngredientsMetadata[baseIngId].demon = baseIngsMetadata[baseIngId].demon;\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    public isFused(): boolean {\r\n        if (!this.ingredients) { return false; }\r\n        return this.ingredients.length > 0;\r\n    }\r\n\r\n    public getBaseIngredientsInfo(): { [id: number]: { count: number, demon: Demon } } {\r\n        return this.baseIngredientsMetadata;\r\n    }\r\n\r\n    public getBaseIngredientsDemons(): { [id: number]: Demon } {\r\n        let ret: { [id: number]: Demon } = {};\r\n        for (const ingId in this.baseIngredientsMetadata) {\r\n            ret[ingId] = this.baseIngredientsMetadata[ingId].demon;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public getBaseIngredientsCounts(): { [id: number]: number } {\r\n        let ret: { [id: number]: number } = {};\r\n        for (const ingId in this.baseIngredientsMetadata) {\r\n            ret[ingId] = this.baseIngredientsMetadata[ingId].count;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public toBaseIngredientSearchString(): string {\r\n        return Object.values(this.getBaseIngredientsDemons()).map(demon => demon.name).join(\" \");\r\n    }\r\n\r\n    public isWeakerThanBaseIngredients(): boolean {\r\n        let lvl: number = 0;\r\n        for (const demon of Object.values(this.getBaseIngredientsDemons())) {\r\n            if (demon.lvl > lvl) {\r\n                lvl = demon.lvl\r\n            }\r\n        }\r\n        return this.demon.lvl < lvl;\r\n    }\r\n}\r\n\r\nexport class DemonsPreset {\r\n    caption: string = \"\";\r\n    demons: Demon[] = [];\r\n\r\n    constructor(caption: string, demons: Demon[]) {\r\n        this.caption = caption;\r\n        this.demons = demons;\r\n    }\r\n}\r\n\r\nexport class FusionResults {\r\n    data: { [ingredientCount: number]: { [demonId: number]: FusedDemon[] } };\r\n    private metadata: {\r\n        ingredientCountMap: { [demonId: number]: number },\r\n        maxIngredient: number\r\n    };\r\n\r\n    constructor(maxIngredient?: number) {\r\n        this.data = {};\r\n        this.metadata = { ingredientCountMap: {}, maxIngredient: 0 };\r\n\r\n        if (maxIngredient) {\r\n            this.metadata.maxIngredient = maxIngredient;\r\n            for (let size = 1; size <= maxIngredient; size++) {\r\n                this.data[size] = {};\r\n            }\r\n        }\r\n    }\r\n\r\n    public getIngredientCount(demonId: number): number | undefined {\r\n        return this.metadata.ingredientCountMap[demonId];\r\n    }\r\n\r\n    public hasFusionResult(): boolean {\r\n        let hasFusionResult = false;\r\n        for (const ingCount in this.data) {\r\n            if (Number(ingCount) === 1) { continue; }\r\n            if (Object.keys(this.data[ingCount]).length > 0) { \r\n                hasFusionResult = true;\r\n                break; }\r\n        }\r\n        return hasFusionResult;\r\n    }\r\n\r\n    public addFusedDemonsOfSameSpecies(fusedDemons: FusedDemon[]): void {\r\n        if (fusedDemons.length === 0) { return; }\r\n        let ingCount: number = 0;\r\n        Object.values(fusedDemons[0].getBaseIngredientsCounts()).map(count => ingCount += count);\r\n        const species: Demon = fusedDemons[0].demon;\r\n        if (!this.addNewSpecies(species, ingCount)) { return; }\r\n        for (const fusedDemon of fusedDemons) {\r\n            this.data[ingCount][species.id].push(fusedDemon);\r\n        }\r\n    }\r\n\r\n    public updateMetaData(): void {\r\n        this.populateFusionResultsIngCountMap();\r\n    }\r\n\r\n    public filter(filterFunc: (demon: FusedDemon) => boolean): void {\r\n        for (const ingCount in this.data) {\r\n            if (Number(ingCount) === 1) { continue; }\r\n            for (const id in this.data[ingCount]) {\r\n                let demonAry: FusedDemon[] = this.data[ingCount][id];\r\n                demonAry = demonAry.filter(filterFunc);\r\n                this.data[ingCount][id] = demonAry;\r\n                if (demonAry.length === 0) {\r\n                    delete this.data[ingCount][id];\r\n                    delete this.metadata.ingredientCountMap[id];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getMaxIngredient(): number {\r\n        return this.metadata.maxIngredient;\r\n    }\r\n\r\n    private addNewSpecies(species: Demon, ingCount: number): boolean {\r\n        if (ingCount > this.metadata.maxIngredient) { return false; }\r\n        const existingIngCount: number | undefined = this.getIngredientCountForSpecies(species);\r\n        if (existingIngCount !== undefined && existingIngCount < ingCount) { return false; }\r\n\r\n        if (!this.data[ingCount][species.id]) {\r\n            this.data[ingCount][species.id] = [];\r\n            this.metadata.ingredientCountMap[species.id] = ingCount;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private getIngredientCountForSpecies(species: Demon): number | undefined {\r\n        return this.metadata.ingredientCountMap[species.id];\r\n    }\r\n\r\n    private populateFusionResultsIngCountMap(): void {\r\n        for (const ingCount in this.data) {\r\n            for (const id in this.data[ingCount]) {\r\n                this.metadata.ingredientCountMap[Number(id)] = Number(ingCount);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class Recipe {\r\n    resultId: number;\r\n    ingredients: { [demonId: number]: number } = {};\r\n\r\n    constructor(resultId: number) {\r\n        this.resultId = resultId;\r\n    }\r\n\r\n    public static clone(recipe: Recipe): Recipe {\r\n        const clonedRecipe = new Recipe(recipe.resultId);\r\n        clonedRecipe.ingredients = {...recipe.ingredients};\r\n        return clonedRecipe;\r\n    }\r\n\r\n    public addIngredient(ingredientId: number) {\r\n        this.ingredients[ingredientId] = 0;\r\n    }\r\n\r\n    public registerIngredient(ingredientId: number, baseIngredientCost?: number): boolean {\r\n        if (this.ingredients[ingredientId] === undefined) {\r\n            return false;\r\n        }\r\n        if (baseIngredientCost !== undefined && baseIngredientCost > 0) {\r\n            this.ingredients[ingredientId] = baseIngredientCost;\r\n        }\r\n        else {\r\n            this.ingredients[ingredientId] = 1;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public isViable(): boolean {\r\n        for (const ingId in this.ingredients) {\r\n            if (this.ingredients[ingId] === 0) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public totalBaseIngredientsCost(): number {\r\n        let sum: number = 0;\r\n        for (const ingId in this.ingredients) {\r\n            sum += this.ingredients[ingId];\r\n        }\r\n        return sum;\r\n    }\r\n}\r\n\r\nexport type Ingredients = { [demonId: number]: boolean };\r\nexport type IngredientsSettings = { [demonId: number]: { mustUse: boolean, multipleUse: boolean } };\r\nexport type MustUseDemonsMap = { [demonId: number]: boolean };\r\nexport type SpecialRecipes = { [ingredientCount: number]: Recipe[] };","import * as Models from './data-models';\r\n\r\ntype DemonInfo = { lvl: number, race: string, stats: number[] };\r\ntype DemonJson = { demons: {[demonName: string]: DemonInfo}, statsName: string[] };\r\ntype FusionSettingsJson = {\r\n    sameRaceFuseToElement?: boolean,\r\n    enableTripleFusion?: boolean,\r\n    disableSameDemonFusion?: boolean,\r\n}\r\ntype FusionChartJson = {\r\n    races: string[],\r\n    raceFusionTable: string[][],\r\n    \r\n    elements?: string[],\r\n    elementFusionTable?: number[][],\r\n    specialRecipes?: { [resultName: string]: string[] }\r\n}\r\ntype Preset = { caption: string, demons: string[] };\r\ntype PresetsJson = { presets: Preset[] };\r\n\r\nconst FUSION_CHART_NULLS: { [nullStr: string]: boolean } = { \"None\": true };\r\n\r\nexport class DemonCompendium {\r\n    private demonsAry: Models.Demon[] = [];\r\n    private normalFusionChart: { [race: string]: { [race: string]: string | undefined } } = {}; // Maps 2 races to the race that results from their fusion. Example usage: x[\"Fairy\"][\"Genma\"] gives you race that results from fusing a Fairy demon with a Genma demon. Special case: when both of the 2 races are the same, the result is a demon's name instead of a race.\r\n    private tripleFusionChart: { [race: string]: { [race: string]: string | undefined } } = {};\r\n    private elementsMap: { [demonId: number]: Models.Demon } = {};\r\n    private elementFusionChart: { [race: string]: { [elementId: string]: number | undefined } } = {};\r\n    private specialRecipes: Models.SpecialRecipes = {};\r\n    private demonsPresets: Models.DemonsPreset[] = [];\r\n\r\n    private _sameRaceFuseToElement: boolean = false;\r\n    private _enableTripleFusion: boolean = false;\r\n    private disableSameDemonFusion: boolean = false;\r\n\r\n    private idMap: { [demonId: number]: Models.Demon } = {}; // Maps id to a demon model object\r\n    private nameMap: { [demonName: string]: Models.Demon } = {} // Maps name to a demon model object\r\n    private raceIdMap: { [race: string]: number } = {}\r\n    private raceLvlDemonMap: { [race: string]: { [lvl: number]: Models.Demon } } = {}; // Maps race-lv a demon with that race and lv. Example usage: x[\"Fairy\"][32] gives you a demon that is a lv32 fairy\r\n\r\n    constructor(demonListJson: DemonJson, fusionChartJson: FusionChartJson, fusionSettingsJson?: FusionSettingsJson, presetJson?: PresetsJson) {\r\n        this.parseDemons(demonListJson);\r\n        this.prepDemonIds();\r\n\r\n        if (fusionSettingsJson) {\r\n            this.parseSettings(fusionSettingsJson);\r\n        }\r\n\r\n        this.parseFusionChart(fusionChartJson);\r\n        this.prepRaceLvlInfo();\r\n        \r\n        if (presetJson) {\r\n            this.parsePresets(presetJson);\r\n        }\r\n    }\r\n\r\n    public getDemonById(id: number): Models.Demon | undefined {\r\n        return this.idMap[id];\r\n    }\r\n\r\n    public getDemonByName(name: string): Models.Demon | undefined {\r\n        return this.nameMap[name];\r\n    }\r\n\r\n    public getDemonArray(): Models.Demon[] {\r\n        return this.demonsAry;\r\n    }\r\n\r\n    public getDemonPresets(): Models.DemonsPreset[] {\r\n        return this.demonsPresets;\r\n    }\r\n\r\n    public getSpecialRecipes(): Models.SpecialRecipes {\r\n        const ret: Models.SpecialRecipes = {};\r\n        for (const ingCount in this.specialRecipes) {\r\n            ret[ingCount] = [];\r\n            for (const recipe of this.specialRecipes[ingCount]) {\r\n                ret[ingCount].push(Models.Recipe.clone(recipe));\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public get enableTripleFusion(): boolean {\r\n        return this._enableTripleFusion;\r\n    }\r\n\r\n    public get sameRaceFuseToElement(): boolean {\r\n        return this._sameRaceFuseToElement;\r\n    }\r\n\r\n    public fuseDemons(demonA: Models.Demon, demonB: Models.Demon): Models.Demon | undefined {\r\n        if (demonA.id === demonB.id && this.disableSameDemonFusion) { return undefined; }\r\n        \r\n        if (this.demonIsElement(demonA) && this.demonIsElement(demonB)) {\r\n            return undefined;\r\n        } else if (this.demonIsElement(demonA) || this.demonIsElement(demonB)) {\r\n            return this.fuseDemonWithElement(demonA, demonB);\r\n        } else if (demonA.race === demonB.race) {\r\n            return this.fuseDemonSameRaceNoElement(demonA, demonB);\r\n        } else {\r\n            return this.fuseDemonDiffRaceNoElement(demonA, demonB);\r\n        }\r\n    }\r\n\r\n    public tripleFuseDemons(demonA: Models.Demon, demonB: Models.Demon, demonC: Models.Demon): Models.Demon | undefined {\r\n        if (this.disableSameDemonFusion) {\r\n            if (demonA.id === demonB.id ||\r\n                demonA.id === demonC.id ||\r\n                demonB.id === demonC.id) { return undefined; }\r\n        }\r\n\r\n        const [demonWeak, demonMid, demonStrong] = [demonA, demonB, demonC].sort((x, y) => (x.lvl !== y.lvl) ? x.lvl - y.lvl : this.getRaceOrder(y.race) - this.getRaceOrder(x.race)); // sort from lowest to highest lv. If lvs are the same, sort by race order from highest to lowest.\r\n        const intermediateRace: string | undefined = this.getFusionRace(demonWeak.race, demonMid.race);\r\n        if (!intermediateRace) { return undefined; }\r\n        const resultRace: string | undefined = this.getTripleFusionRace(intermediateRace, demonStrong.race);\r\n        if (!resultRace) { return undefined; }\r\n        const resultLvlTable: number[] = this.getLvlTableForRace(resultRace);\r\n        const resultLvlTest: number = (demonWeak.lvl + demonMid.lvl + demonStrong.lvl + 12.75) / 3;\r\n        let resultLvl: number = this.findResultLvlFromLvlTable(resultLvlTable, resultLvlTest, true);\r\n        let demonResult: Models.Demon | undefined = this.getDemonFromRaceLvl(resultRace, resultLvl);\r\n        if (!demonResult) { return undefined; }\r\n        if (demonResult.id !== demonWeak.id && demonResult.id !== demonMid.id && demonResult.id !== demonStrong.id) {\r\n            return demonResult;\r\n        } else {\r\n            let resultLvlIndex = resultLvlTable.indexOf(resultLvl);\r\n            if (resultLvlIndex < 0) { return undefined; }\r\n            if (resultLvlIndex + 1 < resultLvlTable.length) {\r\n                resultLvl = resultLvlTable[resultLvlIndex + 1];\r\n                return this.getDemonFromRaceLvl(resultRace, resultLvl);\r\n            } else {\r\n                return undefined;\r\n            }\r\n        }\r\n    }\r\n\r\n    private testGetDemon(demonName?: string): Models.Demon | undefined {\r\n        if (demonName) { return this.getDemonByName(demonName); }\r\n        if (this.demonsAry.length === 0) { return undefined };\r\n        const randomDemonIndex: number = Math.floor(Math.random() * this.demonsAry.length);\r\n        return this.demonsAry[randomDemonIndex];\r\n    }\r\n\r\n    private testGetRandomElement(): Models.Demon | undefined {\r\n        const elementsIds = Object.keys(this.elementsMap);\r\n        const elementsCount = elementsIds.length;\r\n        if (elementsCount === 0) { return undefined };\r\n        const randomElementIdIndex: number = Math.floor(Math.random() * elementsCount);\r\n        const randomElementId: number = Number(elementsIds[randomElementIdIndex]);\r\n        return this.elementsMap[randomElementId];\r\n    }\r\n\r\n    private testFuseDemonWithAll(demonName?: string): void {\r\n        const demon = this.testGetDemon(demonName);\r\n        if (!demon) { return; }\r\n        const results: { [name: string]: Models.Demon} = {};\r\n        for (let i = 0; i < this.demonsAry.length; i++) {\r\n            const demonB = this.demonsAry[i];\r\n            const demonR = this.fuseDemons(demon, demonB);\r\n            if (!demonR) {continue;}\r\n            results[demonB.name] = demonR;\r\n        }\r\n        \r\n        console.log(demon);\r\n        console.log(results);\r\n    }\r\n\r\n    private testTripleFuseDemonWithAll(demonName?: string): void {\r\n        const demon = this.testGetDemon(demonName);\r\n        if (!demon) { return; }\r\n        const results: { [resultName: string]: Models.Demon[][] } = {};\r\n        const results2: { [resultName: string]: { [ing2Name: string]: string[] } } = {};\r\n        for (let i = 0; i < this.demonsAry.length; i++) {\r\n            const demonB = this.demonsAry[i];\r\n            for (let j = i; j < this.demonsAry.length; j++) {\r\n                const demonC = this.demonsAry[j];\r\n                const demonR = this.tripleFuseDemons(demon, demonB, demonC);\r\n                if (!demonR) {continue;}\r\n                if (!results[demonR.name]) { results[demonR.name] = []; }\r\n                if (!results2[demonR.name]) { results2[demonR.name] = {}; }\r\n                if (!results2[demonR.name][demonB.name]) { results2[demonR.name][demonB.name] = []; }\r\n                if (!results2[demonR.name][demonC.name]) { results2[demonR.name][demonC.name] = []; }\r\n                results[demonR.name].push([demonB, demonC]);\r\n                results2[demonR.name][demonB.name].push(demonC.name);\r\n                results2[demonR.name][demonC.name].push(demonB.name);\r\n            }\r\n        }\r\n        console.log(demon);\r\n        console.log(results);\r\n        console.log(results2);\r\n    }\r\n\r\n    private parseDemons(demonsJson: DemonJson): void {\r\n        Models.Demon.statsName = demonsJson.statsName;\r\n        const demons = demonsJson.demons;\r\n        for (const demonName in demons) {\r\n            const demon = demons[demonName]\r\n            this.demonsAry.push(new Models.Demon(\r\n                0,\r\n                demonName,\r\n                demon.lvl,\r\n                demon.race,\r\n                demon.stats\r\n            ));\r\n        }\r\n    }\r\n\r\n    private parseSettings(fusionSettingsJson: FusionSettingsJson): void {\r\n        this._sameRaceFuseToElement = Boolean(fusionSettingsJson.sameRaceFuseToElement);\r\n        this._enableTripleFusion = Boolean(fusionSettingsJson.enableTripleFusion);\r\n        this.disableSameDemonFusion = Boolean(fusionSettingsJson.disableSameDemonFusion);\r\n    }\r\n\r\n    private parseFusionChart(fusionChartJson: FusionChartJson): void {\r\n        for (let row: number = 0; row < fusionChartJson.raceFusionTable.length; row++) {\r\n            for (let col: number = 0; col < fusionChartJson.raceFusionTable[row].length; col++) {\r\n                const dataStructToWriteTo = [];\r\n                if (this._enableTripleFusion) {\r\n                    if (col < row) {\r\n                        dataStructToWriteTo.push(this.tripleFusionChart);\r\n                    } else if (col === row) {\r\n                        dataStructToWriteTo.push(this.tripleFusionChart);\r\n                        dataStructToWriteTo.push(this.normalFusionChart);\r\n                    } else {\r\n                        dataStructToWriteTo.push(this.normalFusionChart);\r\n                    }\r\n                } else {\r\n                    if (col > row) { \r\n                        continue;\r\n                    }\r\n                    dataStructToWriteTo.push(this.normalFusionChart);\r\n                }\r\n\r\n                const raceA: string = fusionChartJson.races[row];\r\n                const raceB: string = fusionChartJson.races[col];\r\n                let raceC: string | undefined = fusionChartJson.raceFusionTable[row][col];\r\n                if (FUSION_CHART_NULLS[raceC])\r\n                {\r\n                    raceC = undefined;\r\n                }\r\n\r\n                for (const chart of dataStructToWriteTo) {\r\n                    // Set the .raceA.raceB property of the parsed fusion table\r\n                    if (!chart[raceA]) {\r\n                        chart[raceA] = {};\r\n                    }\r\n                    chart[raceA][raceB] = raceC;\r\n\r\n                    // Set the .raceB.raceA property of the parsed fusion table\r\n                    if (!chart[raceB]) {\r\n                        chart[raceB] = {};\r\n                    }\r\n                    chart[raceB][raceA] = raceC;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (fusionChartJson.specialRecipes) {\r\n            for (const resultName in fusionChartJson.specialRecipes) {\r\n                // Parse data in the json file\r\n                const result: Models.Demon | undefined = this.getDemonByName(resultName);\r\n                if (!result) { continue; }\r\n                const ingredientsNames: string[] = fusionChartJson.specialRecipes[resultName];\r\n                if (ingredientsNames.length === 0) { continue; }\r\n                const recipe: Models.Recipe = new Models.Recipe(result.id);\r\n                for (const ingredientName of ingredientsNames) {\r\n                    const ingredient: Models.Demon | undefined = this.getDemonByName(ingredientName);\r\n                    if (!ingredient) { continue; }\r\n                    recipe.addIngredient(ingredient.id);\r\n                }\r\n\r\n                // Set parsed data\r\n                result.specialRecipe = true;\r\n                if (!this.specialRecipes[ingredientsNames.length]) {\r\n                    this.specialRecipes[ingredientsNames.length] = [];\r\n                }\r\n                this.specialRecipes[ingredientsNames.length].push(recipe);\r\n            }\r\n        }\r\n\r\n        // Parse race data\r\n        for (let i = 0; i < fusionChartJson.races.length; i++) {\r\n            this.raceIdMap[fusionChartJson.races[i]] = i;\r\n        }\r\n\r\n        // Parse elements data\r\n        if (fusionChartJson.elements && fusionChartJson.elements.length > 0) {\r\n            const elementIdIndexMap: { [elementId: number]: number } = {};\r\n            for (let i = 0; i < fusionChartJson.elements.length; i++) {\r\n                const elementName = fusionChartJson.elements[i];\r\n                const demon = this.getDemonByName(elementName);\r\n                if (!demon) { continue; };\r\n                \r\n                this.elementsMap[demon.id] = demon;\r\n                elementIdIndexMap[demon.id] = i;\r\n            }\r\n\r\n            if (fusionChartJson.elementFusionTable) {\r\n                for (const race in this.raceIdMap) {\r\n                    this.elementFusionChart[race] = {};\r\n                    const raceId: number = this.raceIdMap[race];\r\n                    for (const elementId in this.elementsMap) {\r\n                        const elementIndex = elementIdIndexMap[elementId];\r\n                        if (fusionChartJson.elementFusionTable[raceId]) {\r\n                            this.elementFusionChart[race][elementId] = fusionChartJson.elementFusionTable[raceId][elementIndex];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private parsePresets(presetsJson: PresetsJson): void {\r\n        if (!presetsJson) { return; }\r\n        for (const preset of presetsJson.presets) {\r\n            const demons: Models.Demon[] = [];\r\n            for (const demonName of preset.demons) {\r\n                const demon: Models.Demon | undefined = this.getDemonByName(demonName);\r\n                if (!demon) { continue; }\r\n                demons.push(demon);\r\n            }\r\n            const presetModel = new Models.DemonsPreset(preset.caption, demons);\r\n            this.demonsPresets.push(presetModel);\r\n        }\r\n    }\r\n\r\n    private prepDemonIds(): void {\r\n        this.demonsAry = this.demonsAry.sort((demon1: Models.Demon, demon2: Models.Demon) => { return demon1.lvl > demon2.lvl ? 1 : -1 }); // sort demons alphabetically\r\n        let id: number = 1;\r\n        for (const demon of this.demonsAry) {\r\n            demon.id = id;\r\n            this.idMap[demon.id] = demon;\r\n            this.nameMap[demon.name] = demon;\r\n            id++;\r\n        }\r\n    }\r\n\r\n    private prepRaceLvlInfo(): void {\r\n        for (const demon of this.demonsAry) {\r\n            if (!this.raceLvlDemonMap[demon.race]) {\r\n                this.raceLvlDemonMap[demon.race] = {};\r\n            }\r\n            this.raceLvlDemonMap[demon.race][demon.lvl] = demon;\r\n        }\r\n        for (const demon of this.demonsAry) {\r\n            if (demon.specialRecipe) { continue; }\r\n            demon.rank = this.getLvlTableForRace(demon.race).indexOf(demon.lvl);\r\n        }\r\n    }\r\n\r\n    private getLvlTableForRace(race: string, includeUnfusable?: boolean): number[] {\r\n        if (!this.raceLvlDemonMap[race]) {\r\n            return [];\r\n        }\r\n        const lvlTable: number[] = [];\r\n        for (const lvl in this.raceLvlDemonMap[race]) {\r\n            if (!includeUnfusable && this.demonIsUnfusable(this.raceLvlDemonMap[race][lvl])) {\r\n                continue;\r\n            }\r\n            lvlTable.push(Number(lvl));\r\n        }\r\n        return lvlTable;\r\n    }\r\n\r\n    private getDemonFromRaceLvl(race: string, lvl: number): Models.Demon | undefined {\r\n        if (this.raceLvlDemonMap[race]) {\r\n            if (this.raceLvlDemonMap[race][lvl]) {\r\n                return this.raceLvlDemonMap[race][lvl];\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private getFusionRace(raceA: string, raceB: string): string | undefined {\r\n        if (this.normalFusionChart[raceA]) {\r\n            if (this.normalFusionChart[raceA][raceB]) {\r\n                return this.normalFusionChart[raceA][raceB];\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private getTripleFusionRace(raceA: string, raceB: string): string | undefined {\r\n        if (this.tripleFusionChart[raceA]) {\r\n            if (this.tripleFusionChart[raceA][raceB]) {\r\n                return this.tripleFusionChart[raceA][raceB];\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private getRaceOrder(race: string): number {\r\n        return this.raceIdMap[race];\r\n    }\r\n\r\n    private findResultLvlFromLvlTable(lvlTable: number[], lvlToCheck: number, isTripleFusion?: boolean) {\r\n        let index = 0;\r\n        for (let i = 0; i < lvlTable.length; i++) {\r\n            if (lvlToCheck > lvlTable[i]) {\r\n                index++;\r\n            }\r\n        }\r\n        if (index >= lvlTable.length) { \r\n            if (isTripleFusion) { return -1; }\r\n            index = lvlTable.length - 1 \r\n        };\r\n        return lvlTable[index];\r\n    }\r\n\r\n    private fuseDemonDiffRaceNoElement(demonA: Models.Demon, demonB: Models.Demon): Models.Demon | undefined {\r\n        const raceR: string | undefined = this.getFusionRace(demonA.race, demonB.race);\r\n        if (!raceR) { return undefined; }\r\n        const lvlTableR: number[] = this.getLvlTableForRace(raceR);\r\n        if (lvlTableR.length === 0) { return undefined; }\r\n        const lvlResultTest = (demonB.lvl + demonA.lvl + 1) / 2;\r\n        const lvlR: number = this.findResultLvlFromLvlTable(lvlTableR, lvlResultTest);\r\n        return this.getDemonFromRaceLvl(raceR, lvlR)\r\n    }\r\n\r\n    private fuseDemonSameRaceNoElement(demonA: Models.Demon, demonB: Models.Demon): Models.Demon | undefined {\r\n        if (this._sameRaceFuseToElement) {\r\n            const elementNameR: string | undefined = this.getFusionRace(demonA.race, demonB.race);\r\n            if (!elementNameR) { return undefined; }\r\n            return this.getDemonByName(elementNameR);\r\n        } else {\r\n            const resultLvlTable = this.getLvlTableForRace(demonB.race).filter(lvl => lvl !== demonA.lvl);\r\n            let resultLvlIndex = -1;\r\n            for (const resultLvl of resultLvlTable) {\r\n                if (demonA.lvl + demonB.lvl >= 2 * resultLvl) { resultLvlIndex = resultLvlIndex + 1 }\r\n            }\r\n\r\n            if (resultLvlTable[resultLvlIndex] === demonB.lvl) {\r\n                resultLvlIndex = resultLvlIndex - 1;\r\n            }\r\n\r\n            if (resultLvlIndex < 0) { return undefined; }\r\n            const resultLvl = resultLvlTable[resultLvlIndex];\r\n            return this.getDemonFromRaceLvl(demonA.race, resultLvl);\r\n        }\r\n    }\r\n\r\n    private fuseDemonWithElement(demonA: Models.Demon, demonB: Models.Demon): Models.Demon | undefined {\r\n        let element, demon;\r\n        if (this.demonIsElement(demonA)) {\r\n            element = demonA;\r\n            demon = demonB;\r\n        } else if (this.demonIsElement(demonB)) {\r\n            element = demonB;\r\n            demon = demonA;\r\n        } else {\r\n            return this.fuseDemonSameRaceNoElement(demonA, demonB);\r\n        }\r\n\r\n        const demonRankChange = this.elementFusionChart[demon.race]?.[element.id];\r\n        if (demonRankChange === undefined || demon.rank === undefined) { return undefined; }\r\n        const lvlTable: number[] = this.getLvlTableForRace(demon.race);\r\n        const resultRank: number = demon.rank + demonRankChange;\r\n        if (resultRank < 0 || resultRank >= lvlTable.length) { return undefined; }\r\n        return this.getDemonFromRaceLvl(demon.race, lvlTable[resultRank]);\r\n    }\r\n\r\n    private demonIsElement(demon: Models.Demon): boolean {\r\n        return this.elementsMap[demon.id] !== undefined;\r\n    }\r\n\r\n    private demonIsUnfusable(demon: Models.Demon): boolean {\r\n        return demon.specialRecipe;\r\n    }\r\n}","import React from 'react';\r\n\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell, { TableCellProps } from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport TableSortLabel from '@material-ui/core/TableSortLabel';\r\nimport Paper, { PaperProps } from '@material-ui/core/Paper';\r\n\r\nimport styles from './scss/data-table.module.scss';\r\nimport Pagination from '@material-ui/lab/Pagination';\r\n\r\ntype StatePair<T> = [T, React.Dispatch<React.SetStateAction<T>>];\r\nexport type SortSpec = {\r\n    sortType: 'number' | 'string'\r\n}\r\nexport type ColDef = {\r\n    headerContent?: JSX.Element | string;\r\n    sortSpec?: SortSpec;\r\n    headerProps?: TableCellProps;\r\n}\r\nexport interface DataTableProvider<T> {\r\n    pageSize: number;\r\n    getColumnDefinition(): ColDef[];\r\n    getAllRowsData(): T[];\r\n    renderRow(rowData: T): JSX.Element | string | undefined;\r\n    getSortValue?(rowData: T, sortByCol: number): string | number;\r\n    renderBanner?(): JSX.Element | undefined;\r\n}\r\ninterface DataTableProps extends PaperProps {\r\n    dataTableProvider: DataTableProvider<any>;\r\n}\r\nconst DataTable = (params: DataTableProps): JSX.Element => {\r\n    const {dataTableProvider} = params;\r\n    const [page, setPage] = React.useState<number>(1);\r\n    const [sortByCol, setSortByCol] = React.useState<number | undefined>(undefined);\r\n    const [sortDirection, setSortDirection] = React.useState<\"desc\" | \"asc\" | undefined>(undefined);\r\n    const [sortType, setSortType] = React.useState<\"number\" | \"string\">(\"string\");\r\n    const pageSize: number = dataTableProvider.pageSize;\r\n    let maxPage: number = 1;\r\n\r\n    const colDefs: ColDef[] = dataTableProvider.getColumnDefinition();\r\n    const preIdRowData: any[] = dataTableProvider.getAllRowsData();\r\n    const totalRowCount: number = preIdRowData.length;\r\n\r\n    // Empty row banner\r\n    if (totalRowCount === 0) {\r\n        if (sortByCol !== undefined) { setSortByCol(undefined); }\r\n        if (page !== 1) { setPage(1); }\r\n        if (sortDirection !== undefined) { setSortDirection(undefined); }\r\n        let ret = <React.Fragment />;\r\n        let banner = dataTableProvider.renderBanner? dataTableProvider.renderBanner() : undefined;\r\n        if (banner) { ret = banner }\r\n        return ret;\r\n    }\r\n\r\n    // Shift page down if table loses rows\r\n    maxPage = Math.ceil(totalRowCount / pageSize);\r\n    if ((page - 1)* pageSize >= totalRowCount)\r\n    {\r\n        setPage(Math.ceil(totalRowCount / pageSize));\r\n        return <React.Fragment />;\r\n    }\r\n\r\n    // ID rows\r\n    const rowData: { id: number, data: any }[] = preIdRowData.map((rd, index) => { return { id: index, data: rd } });\r\n\r\n    // Sort rows\r\n    if ((sortByCol !== undefined) && (sortDirection !== undefined) && (dataTableProvider.getSortValue !== undefined)) {\r\n        const getSortValue = dataTableProvider.getSortValue.bind(dataTableProvider);\r\n        const sortMult: number = (sortDirection === \"asc\") ? 1 : -1;\r\n        const comparitor: (...x: any) => number = (sortType === \"number\") ? numberComparitor : stringComparitor;\r\n        rowData.sort((a, b) => { \r\n            const valA = getSortValue(a.data, sortByCol);\r\n            const valB = getSortValue(b.data, sortByCol);\r\n            return sortMult * comparitor(valA, valB) });\r\n    }\r\n\r\n    // Paginate\r\n    const paginizedRowData = rowData.filter((data, index) => (index >= (page - 1) * pageSize) && (index < page * pageSize));\r\n    function changePage(event: React.ChangeEvent<unknown>, value: number) {\r\n        setPage(value);\r\n    }\r\n    \r\n    // Render headers\r\n    const headerCells: JSX.Element[] = [];\r\n    let colNum: number = 0;\r\n    for (const colDef of colDefs) {\r\n        const headerContent = colDef.sortSpec ? buildSortableHeaderCellContent(colDef.headerContent, colNum, colDef.sortSpec.sortType, [sortByCol, setSortByCol], [sortDirection, setSortDirection], [sortType, setSortType]) : colDef.headerContent;\r\n\r\n        headerCells.push(<TableCell key={\"H-\" + colNum} {...colDef.headerProps}>{headerContent}</TableCell>);\r\n        colNum++;\r\n    }\r\n\r\n    // Render rows\r\n    const renderedRows: JSX.Element[] = [];\r\n    for (const row of paginizedRowData) {\r\n        renderedRows.push(\r\n            <TableRow key={row.id}>\r\n                {dataTableProvider.renderRow(row.data)}\r\n            </TableRow>\r\n        )\r\n    }\r\n\r\n    let paperContainerClassName: string = styles.paperContainer;\r\n    if (params.className) {\r\n        paperContainerClassName += \" \" + params.className;\r\n    }\r\n\r\n    return <Paper className={paperContainerClassName} elevation={3}>\r\n        <TableContainer className={styles.tableContainer}>\r\n            <Table>\r\n                <TableHead className={styles.header}>\r\n                    <TableRow>\r\n                        {headerCells}\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody className={styles.tableBody}>\r\n                    {renderedRows}\r\n                </TableBody>\r\n            </Table>\r\n            <Pagination count={maxPage} page={page} onChange={changePage} size=\"small\" />\r\n        </TableContainer>\r\n    </Paper>\r\n};\r\nexport default DataTable;\r\n\r\nfunction stringComparitor(a: string, b: string): number {\r\n    return (a > b) ? 1 : (a === b) ? 0 : -1;\r\n}\r\n\r\nfunction numberComparitor(a: number, b: number): number {\r\n    return a - b;\r\n}\r\n\r\nfunction buildSortableHeaderCellContent(\r\n    headerInnerContent: JSX.Element | string | undefined,\r\n    id: number,\r\n    colSortType: \"number\" | \"string\",\r\n    _sortByCol: StatePair<number | undefined>,\r\n    _sortDirection: StatePair<\"desc\" | \"asc\" | undefined>,\r\n    _sortType: StatePair<\"number\" | \"string\">\r\n): JSX.Element {\r\n    const [sortByCol] = _sortByCol;\r\n    const [sortDirection] = _sortDirection;\r\n\r\n    return <TableSortLabel\r\n        active={sortByCol === id && sortDirection !== undefined}\r\n        direction={sortByCol === id ? sortDirection : undefined}\r\n        onClick={createSortHandler(id, colSortType, _sortByCol, _sortDirection, _sortType)}>\r\n        {headerInnerContent}\r\n    </TableSortLabel>;\r\n}\r\n\r\nfunction createSortHandler(id: number,\r\n    colSortType: \"number\" | \"string\",\r\n    _sortByCol: StatePair<number | undefined>,\r\n    _sortDirection: StatePair<\"desc\" | \"asc\" | undefined>,\r\n    _sortType: StatePair<\"number\" | \"string\">\r\n): (event: React.MouseEvent<HTMLSpanElement, MouseEvent>) => void {\r\n    return (event: React.MouseEvent<HTMLSpanElement, MouseEvent>) => {\r\n        const [sortByCol, setOrderBy] = _sortByCol;\r\n        const [sortDirection, setSortDirection] = _sortDirection;\r\n        const [, setSortType] = _sortType;\r\n\r\n        let nextSortDirection = sortDirection;\r\n        if (sortByCol === id) {\r\n            if (sortDirection === \"asc\") { nextSortDirection = \"desc\" }\r\n            if (sortDirection === \"desc\") { nextSortDirection = undefined }\r\n            if (sortDirection === undefined) {nextSortDirection = \"asc\"}\r\n        } else {\r\n            nextSortDirection = \"asc\";\r\n        }\r\n        setSortDirection(nextSortDirection);\r\n        setOrderBy(id);\r\n        setSortType(colSortType);\r\n    };\r\n}","import React from 'react';\r\n\r\nimport * as Models from '../data/data-models';\r\nimport { DemonCompendium } from '../data/demon-compendium';\r\n\r\nimport DataTable, * as DataTables from './data-table';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport { WarningBanner } from './minor-ui-components';\r\n\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport WarningIcon from '@material-ui/icons/Warning';\r\nimport CancelIcon from '@material-ui/icons/Cancel';\r\n\r\nimport styles from './scss/ingredients-table.module.scss';\r\n\r\n//====================================================================================================\r\n\r\ntype RemoveDemonButtonProps = {\r\n    demonId: number;\r\n    onRemoveIngredient?: (deletedId: number) => void;\r\n}\r\nfunction RemoveDemonButton(params: RemoveDemonButtonProps): JSX.Element {\r\n\r\n    function onIconButtonClick(event: React.MouseEvent<HTMLButtonElement, MouseEvent>): void {\r\n        if (params.onRemoveIngredient) {\r\n            params.onRemoveIngredient(params.demonId);\r\n        }\r\n    }\r\n\r\n    return <IconButton onClick={onIconButtonClick} className={styles.removeDemonButton}>\r\n    <CancelIcon className={styles.removeDemonButtonIcon}/>\r\n  </IconButton>\r\n}\r\n\r\n//====================================================================================================\r\n\r\nenum IngredientsSettingsEnum {\r\n    multipleUse = 1,\r\n    mustUse = 2\r\n}\r\ntype CheckboxSettingProps = {\r\n    demonId: number,\r\n    setting: IngredientsSettingsEnum,\r\n    ingredientsSettings: Models.IngredientsSettings\r\n}\r\nfunction CheckboxSetting(params: CheckboxSettingProps): JSX.Element {\r\n    const {demonId, setting, ingredientsSettings} = params;\r\n    let defaultChecked: boolean = false;\r\n    switch (setting) {\r\n        case IngredientsSettingsEnum.mustUse: {\r\n            defaultChecked = ingredientsSettings[demonId].mustUse;\r\n            break;\r\n        }\r\n        case IngredientsSettingsEnum.multipleUse: \r\n        default: {\r\n            defaultChecked = ingredientsSettings[demonId].multipleUse;\r\n        }\r\n    }\r\n\r\n    function onCheckboxChange(event: React.ChangeEvent<HTMLInputElement>, checked: boolean): void {\r\n        switch (setting) {\r\n            case IngredientsSettingsEnum.mustUse: {\r\n                ingredientsSettings[demonId].mustUse = event.target.checked;\r\n                break;\r\n            }\r\n            case IngredientsSettingsEnum.multipleUse: \r\n            default: {\r\n                ingredientsSettings[demonId].multipleUse = event.target.checked;\r\n            }\r\n        }\r\n    }\r\n\r\n    return <Checkbox\r\n        className={styles.checkBox}\r\n        defaultChecked={defaultChecked}\r\n        onChange={onCheckboxChange}\r\n        color=\"default\"\r\n    />;\r\n}\r\n\r\n//====================================================================================================\r\n\r\nfunction initializeIngredientsSettings(ingredients: Models.Ingredients, ingredientsSettings: Models.IngredientsSettings) {\r\n    for (const demonId in ingredients) {\r\n        if (!ingredientsSettings[demonId]) {\r\n            ingredientsSettings[demonId] = { mustUse: false, multipleUse: false };\r\n        }\r\n    }\r\n}\r\n\r\n//====================================================================================================\r\n\r\ntype FusionIngredientsTableProps = {\r\n    demonCompendium: DemonCompendium\r\n    ingredients: Models.Ingredients\r\n    ingredientsSettings: Models.IngredientsSettings\r\n    onRemoveIngredient?: (deletedId: number) => void;\r\n}\r\nclass FusionIngredientsDataTableProvider implements DataTables.DataTableProvider<Models.Demon> {\r\n\r\n    pageSize: number = 25;\r\n\r\n    getColumnDefinition(): DataTables.ColDef[] {\r\n        return [\r\n            { headerContent: \"Demon\", sortSpec: { sortType: \"string\" }, headerProps: {className: styles.nameColumnHeader} },\r\n            { headerContent: \"Level\", sortSpec: { sortType: \"number\" }, headerProps: {className: styles.raceColumnHeader} },\r\n            { headerContent: \"Race\", sortSpec: { sortType: \"string\" } },\r\n            { headerContent: \"Only Show Recipes That Use This Demon\", headerProps: { width: 150, align: \"center\" } },\r\n            { headerContent: \"Can Use Multiple per Recipe\", headerProps: { width: 120, align: \"center\" } },\r\n            {}\r\n        ];\r\n    }\r\n\r\n    getAllRowsData(): Models.Demon[] {\r\n        return this.allRowsData;\r\n    }\r\n\r\n    renderRow(rowData: Models.Demon): JSX.Element {\r\n        return <React.Fragment>\r\n            <TableCell>\r\n                {rowData.name}\r\n            </TableCell>\r\n            <TableCell>\r\n                {rowData.lvl}\r\n            </TableCell>\r\n            <TableCell>\r\n                {rowData.race}\r\n            </TableCell>\r\n            <TableCell align=\"center\">\r\n                <CheckboxSetting demonId={rowData.id} setting={IngredientsSettingsEnum.mustUse} ingredientsSettings={this.ingredientsSettings} />\r\n            </TableCell>\r\n            <TableCell align=\"center\">\r\n                <CheckboxSetting demonId={rowData.id} setting={IngredientsSettingsEnum.multipleUse} ingredientsSettings={this.ingredientsSettings} />\r\n            </TableCell>\r\n            <TableCell>\r\n                <RemoveDemonButton demonId={rowData.id} onRemoveIngredient={this.onRemoveIngredient} />\r\n            </TableCell>\r\n        </React.Fragment>;\r\n    }\r\n    \r\n    getSortValue(rowData: Models.Demon, sortByCol: number): string | number {\r\n        switch(sortByCol) {\r\n            case 0: { \r\n                return rowData.name; }\r\n            case 1: { \r\n                return rowData.lvl; }\r\n            case 2: { \r\n                return rowData.race; }\r\n            default: {\r\n                return rowData.name; }\r\n        };\r\n    }\r\n\r\n    renderBanner(): JSX.Element {\r\n        const icon = <WarningIcon className={styles.warningIcon}/>;\r\n        return <WarningBanner message=\"No ingredient demons. Use the section above to add demons to use for fusions.\" icon={icon}/>\r\n    }\r\n\r\n    demonCompendium: DemonCompendium;\r\n    ingredients: Models.Ingredients;\r\n    ingredientsSettings: Models.IngredientsSettings;\r\n    onRemoveIngredient?: (deletedId: number) => void;\r\n\r\n    allRowsData: Models.Demon[];\r\n\r\n    constructor(params: FusionIngredientsTableProps, allRowsData: Models.Demon[]) {\r\n        this.demonCompendium = params.demonCompendium;\r\n        this.ingredients = params.ingredients;\r\n        this.ingredientsSettings = params.ingredientsSettings;\r\n        this.onRemoveIngredient = params.onRemoveIngredient;\r\n\r\n        this.allRowsData = allRowsData;\r\n    }\r\n}\r\n\r\nconst IngredientsTable = (params: FusionIngredientsTableProps): JSX.Element => {\r\n    initializeIngredientsSettings(params.ingredients, params.ingredientsSettings);\r\n    const rowData: Models.Demon[] = React.useMemo(() => {\r\n        let rowData: Models.Demon[] = [];\r\n        for (const demonId in params.ingredients) {\r\n            const demon = params.demonCompendium.getDemonById(Number(demonId));\r\n            if (!demon) { continue; }\r\n            rowData.push(demon);\r\n        }\r\n        return rowData;\r\n    }, [params.ingredients, params.demonCompendium]);\r\n    const dataProvider = new FusionIngredientsDataTableProvider(params, rowData);\r\n    return <DataTable dataTableProvider={dataProvider} className={styles.dataTable}/>\r\n}\r\nexport default React.memo(IngredientsTable);","import React from 'react';\r\n\r\nimport { Paper } from '@material-ui/core';\r\n\r\nimport styles from './scss/minor-ui-components.module.scss';\r\n\r\ntype WarningBannerProps = {\r\n    message?: string;\r\n    icon?: JSX.Element;\r\n    className?: string;\r\n}\r\nconst WarningBannerCore = (params: WarningBannerProps): JSX.Element => {\r\n    let icon;\r\n    if (params.icon) {\r\n        icon = <div className={styles.icon}>{params.icon}</div>\r\n    }\r\n    return <Paper className={params.className? params.className : styles.warningBanner}>\r\n        {icon}<span>{params.message}</span>\r\n    </Paper>\r\n}\r\nexport const WarningBanner = React.memo(WarningBannerCore);","import React from 'react';\r\n\r\nimport * as Models from '../data/data-models';\r\n\r\nimport DataTable, * as DataTables from './data-table';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport {WarningBanner} from './minor-ui-components';\r\n\r\nimport styles from './scss/results-table.module.scss';\r\nimport Button from '@material-ui/core/Button';\r\n\r\nclass FusionResultsDataTableProvider implements DataTables.DataTableProvider<Models.FusedDemon> {\r\n\r\n    pageSize: number = 50;\r\n\r\n    getColumnDefinition(): DataTables.ColDef[] {\r\n        const colDefs: DataTables.ColDef[] = [\r\n            { headerContent: \"Demon\", sortSpec: { sortType: \"string\" }, headerProps: { className: styles.nameColumn } },\r\n            { headerContent: \"Level\", sortSpec: { sortType: \"number\" }, headerProps: { className: styles.lvlColumn } },\r\n            { headerContent: \"Race\", sortSpec: { sortType: \"string\" }, headerProps: { className: styles.raceColumn } },\r\n        ];\r\n        const statsName: string[] = Models.Demon.statsName;\r\n        for (let i = 0; i < statsName.length; i++) {\r\n            colDefs.push(\r\n                { headerContent: statsName[i], headerProps: { className: styles.statColumn }, sortSpec: { sortType: \"number\" } }\r\n            );\r\n        }\r\n        colDefs.push({ headerContent: \"Ingredients Used\", sortSpec: { sortType: \"number\" }, headerProps: { className: styles.ingredientsColumn } });\r\n        colDefs.push({ headerContent: \"\" });\r\n        this.columnCount = colDefs.length;\r\n        return colDefs;\r\n    }\r\n\r\n    getAllRowsData(): Models.FusedDemon[] {\r\n        const resultsAsRowsArray: Models.FusedDemon[] = [];\r\n        for (const ingCountStr in this.fusionResults.data) {\r\n            const ingCount = Number(ingCountStr);\r\n            if (Number(ingCount) === 1) { continue; }\r\n            for (const demonId in this.fusionResults.data[ingCount]) {\r\n                for (const fusedDemon of this.fusionResults.data[ingCount][demonId]) {\r\n                    resultsAsRowsArray.push(fusedDemon);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return resultsAsRowsArray;\r\n    }\r\n\r\n    renderRow(fusedDemon: Models.FusedDemon): JSX.Element {\r\n        const renderedRow: JSX.Element[] = [];\r\n        let keyId: number = 0;\r\n        renderedRow.push(<React.Fragment key={keyId}>\r\n            <TableCell className={styles.nameColumn}>\r\n                {fusedDemon.demon.name}\r\n            </TableCell>\r\n            <TableCell className={styles.lvlColumn}>\r\n                {fusedDemon.demon.lvl}\r\n            </TableCell>\r\n            <TableCell className={styles.raceColumn}>\r\n                {fusedDemon.demon.race}\r\n            </TableCell>\r\n        </React.Fragment>);\r\n        keyId++;\r\n        for (const stat of fusedDemon.demon.stats) {\r\n            renderedRow.push(<React.Fragment key={keyId}>\r\n                <TableCell className={styles.statColumn}>\r\n                    {stat}\r\n                </TableCell>\r\n            </React.Fragment>);\r\n            keyId++;\r\n        }\r\n        renderedRow.push(<React.Fragment key={keyId}>\r\n            <TableCell className={styles.ingredientsColumn}>\r\n                {this.fusionResults.getIngredientCount(fusedDemon.demon.id)}\r\n            </TableCell>\r\n        </React.Fragment>);\r\n        keyId++;\r\n        renderedRow.push(<React.Fragment key={keyId}>\r\n            <TableCell>\r\n            <Button variant=\"outlined\" onClick={this.recipesButtonHandler.bind(undefined, fusedDemon.demon.id)} className={styles.recipeButton}>View recipes</Button>\r\n            </TableCell>\r\n        </React.Fragment>);\r\n        keyId++;\r\n        return <React.Fragment>{renderedRow}</React.Fragment>;\r\n    }\r\n    \r\n    getSortValue(rowData: Models.FusedDemon, sortByCol: number): string | number {\r\n        switch(sortByCol) {\r\n            case 0: { \r\n                return rowData.demon.name; }\r\n            case 1: { \r\n                return rowData.demon.lvl; }\r\n            case 2: { \r\n                return rowData.demon.race; }\r\n            case (this.columnCount - 2):\r\n                return this.fusionResults.getIngredientCount(rowData.demon.id) || 0;\r\n            default: {\r\n                return rowData.demon.stats[sortByCol-3]; }\r\n        };\r\n    }\r\n\r\n    renderBanner(): JSX.Element {\r\n        return <WarningBanner message=\"No results found\" />\r\n    }\r\n\r\n    fusionResults: Models.FusionResults;\r\n    recipesButtonHandler: (...x: any) => void;\r\n    \r\n    columnCount: number = 0;\r\n\r\n    constructor(params: FusionResultsTableProps, onRecipesButtonClick: (demonId: number) => void) {\r\n        this.recipesButtonHandler = onRecipesButtonClick;\r\n        this.fusionResults = params.fusionResults;\r\n    }\r\n}\r\n\r\ntype FusionResultsTableProps = {\r\n    fusionResults: Models.FusionResults,\r\n    onOpenDemonRecipes: (demonId: number) => void\r\n}\r\nconst ResultsTable = (props: FusionResultsTableProps): JSX.Element => {\r\n\r\n    function openDemonRecipesHandler(demonId: number) {\r\n      props.onOpenDemonRecipes(demonId);\r\n    }\r\n    \r\n    const dataProvider = new FusionResultsDataTableProvider(props, openDemonRecipesHandler);\r\n    return <DataTable dataTableProvider={dataProvider} className={styles.dataTable}/>\r\n};\r\nexport default React.memo(ResultsTable);","import React, { useState } from 'react';\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport Paper from '@material-ui/core/Paper';\r\n\r\nimport styles from './scss/settings-panel.module.scss';\r\n\r\nexport class UserSettings {\r\n    charLvl: number = 99;\r\n    maxIngredient: number = 3;\r\n    useTripleFusion: boolean = false;\r\n\r\n    useTripleFusionSettingIsVisible: boolean = false;\r\n}\r\nexport type SettingsPanelEventHandlers = { toggleVisibility?: Function }\r\ntype SettingsPanelProps = {\r\n    eventHandlers: SettingsPanelEventHandlers,\r\n    settings: UserSettings\r\n}\r\nexport default function SettingsPanel(params: SettingsPanelProps) : JSX.Element {\r\n    const {eventHandlers, settings } = params;\r\n    \r\n    const [isVisible, setIsVisible] = useState<boolean>(false);\r\n    const [charLvlFieldValue, setCharLvlFieldValue] = useState<number | string>(settings.charLvl);\r\n    const [maxIngFieldValue, setMaxIngFieldValue] = useState<number | string>(settings.maxIngredient);\r\n\r\n    function onVisibilityToggle(): void {\r\n        setIsVisible(!isVisible);\r\n    }\r\n    eventHandlers.toggleVisibility = onVisibilityToggle;\r\n\r\n    function onSetCharLvl(newValue: number): void {\r\n        settings.charLvl = newValue;\r\n    }\r\n\r\n    function onSetMaxIng(newValue: number): void {\r\n        settings.maxIngredient = newValue;\r\n    }\r\n\r\n    function onSetUseTripleFusion(newValue: boolean): void {\r\n        settings.useTripleFusion = newValue;\r\n    }\r\n\r\n    const settingsPanelStyle: React.CSSProperties = {};\r\n    if (!isVisible) { settingsPanelStyle.height = \"0px\"; }\r\n    return <div style={settingsPanelStyle} className={styles.settingsPanel}>\r\n        <Paper variant=\"outlined\" className={styles.paper}>\r\n            <h2>Settings</h2>\r\n            <NumberSettings\r\n                label=\"Character level\"\r\n                min={1}\r\n                max={99}\r\n                emptyFieldValue={99}\r\n                fieldStateValueAndSetter={[charLvlFieldValue, setCharLvlFieldValue]}\r\n                onSetSettings={onSetCharLvl} />\r\n            <NumberSettings\r\n                label=\"Max ingredients per recipe\"\r\n                min={2}\r\n                max={5}\r\n                emptyFieldValue={3}\r\n                fieldStateValueAndSetter={[maxIngFieldValue, setMaxIngFieldValue]}\r\n                onSetSettings={onSetMaxIng} />\r\n            {settings.useTripleFusionSettingIsVisible ?\r\n                <CheckboxSettings\r\n                    label=\"Allow triple fusion\"\r\n                    checked={settings.useTripleFusion}\r\n                    onSetSettings={onSetUseTripleFusion}\r\n                /> : undefined}\r\n        </Paper>\r\n    </div>\r\n}\r\n\r\ntype NumberSettingsProp = {\r\n    label: string,\r\n    fieldStateValueAndSetter: [number | string, React.Dispatch<React.SetStateAction<number | string>>],\r\n    onSetSettings: (newValue: number) => void,\r\n    min: number,\r\n    max: number,\r\n    emptyFieldValue: number\r\n}\r\nfunction NumberSettings(params: NumberSettingsProp): JSX.Element {\r\n    const {label, fieldStateValueAndSetter: stateValueAndSetter, onSetSettings, min, max, emptyFieldValue} = params;\r\n    const [stateValue, stateSetter] = stateValueAndSetter;\r\n\r\n    function onNumberFieldChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        let value: number | string = event.target.value;\r\n        if (value === \"\") {\r\n            stateSetter(\"\");\r\n            onSetSettings(emptyFieldValue);\r\n            return;\r\n        }\r\n        const valueAsNumber = Number(value);\r\n        if (valueAsNumber >= min && valueAsNumber <= max) {\r\n            stateSetter(valueAsNumber);\r\n            onSetSettings(valueAsNumber);\r\n        }\r\n    }\r\n    return <div className={`${styles.settingsLine} ${styles.numberSettings}`}>\r\n        <span className={styles.numberFieldLabel}>{label}</span>\r\n        <TextField\r\n            style={{ width: \"50px\" }}\r\n            type=\"number\"\r\n            InputLabelProps={{ shrink: true }}\r\n            inputProps={{ min: min, max: max, step: 1 }}\r\n            variant=\"outlined\"\r\n            value={stateValue}\r\n            onChange={onNumberFieldChange}\r\n        />\r\n    </div>;\r\n}\r\n\r\ntype CheckboxSettingsProps = {\r\n    label: string,\r\n    checked: boolean,\r\n    onSetSettings: (newValue: boolean) => void\r\n}\r\nfunction CheckboxSettings(params: CheckboxSettingsProps): JSX.Element {\r\n    const {label, checked, onSetSettings} = params;\r\n\r\n    function onCheckboxChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        onSetSettings(event.target.checked);\r\n    }\r\n\r\n    return <div className={`${styles.settingsLine}`}>\r\n        <FormControlLabel\r\n            control={\r\n                <Checkbox\r\n                    defaultChecked={checked}\r\n                    onChange={onCheckboxChange}\r\n                    color=\"default\"\r\n                />}\r\n            label={label} />\r\n    </div>;\r\n}","import React, { KeyboardEvent, useState } from 'react';\r\n\r\nimport * as Models from '../data/data-models';\r\nimport { DemonCompendium } from '../data/demon-compendium';\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Button from '@material-ui/core/Button';\r\nimport Autocomplete from '@material-ui/lab/Autocomplete';\r\n\r\nimport AddIcon from '@material-ui/icons/Add';\r\nimport styles from './scss/ui-components.module.scss';\r\n\r\nexport default function DemonAdder(params: {\r\n    demonCompendium: DemonCompendium,\r\n    onAddDemon: (demon: Models.Demon[]) => void\r\n}): JSX.Element {\r\n    const { demonCompendium, onAddDemon } = params;\r\n\r\n    let presetSection: JSX.Element = <React.Fragment />;\r\n    if (demonCompendium.getDemonPresets().length > 0) { \r\n        presetSection = <React.Fragment>\r\n            <p>Add from presets</p>\r\n            <AddByPreset demonCompendium={demonCompendium} onAddDemon={onAddDemon} />\r\n        </React.Fragment>;\r\n    }\r\n\r\n    return <div className={styles.demonAdderContainer}>\r\n        <p>Add by searching</p>\r\n        <AddByDemon demonCompendium={demonCompendium} onAddDemon={onAddDemon} />\r\n        <p>Add by entering level range</p>\r\n        <AddByLevelRange demonCompendium={demonCompendium} onAddDemon={onAddDemon} />\r\n        {presetSection}\r\n    </div>\r\n}\r\n\r\nfunction AddByDemon(params: {\r\n    demonCompendium: DemonCompendium,\r\n    onAddDemon: (demon: Models.Demon[]) => void\r\n}): JSX.Element {\r\n    const { demonCompendium, onAddDemon } = params;\r\n    let [selectedDemon, setSelectedDemon] = useState<Models.Demon | null>(null);\r\n    let searchOptions: Models.Demon[] = demonCompendium.getDemonArray();\r\n\r\n    const onSearchBarSelectionChange: any = (event: React.ChangeEvent<HTMLInputElement>, selection: Models.Demon) => {\r\n        setSelectedDemon(selection);\r\n    };\r\n\r\n    function onAddButtonClick() {\r\n        raiseOnAddDemonEvent();\r\n    }\r\n\r\n    function onKeyPress(event: React.KeyboardEvent<HTMLDivElement>) {\r\n        if (event.key === \"Enter\") {\r\n            raiseOnAddDemonEvent();\r\n        }\r\n    }\r\n\r\n    function raiseOnAddDemonEvent() {\r\n        if (selectedDemon) {\r\n            onAddDemon([selectedDemon]);\r\n            setSelectedDemon(null);\r\n        }\r\n    }\r\n\r\n    return (<div className={styles.subAdderContainer}>\r\n        <Autocomplete\r\n            value={selectedDemon}\r\n            options={searchOptions}\r\n            onChange={onSearchBarSelectionChange}\r\n            onKeyPress={onKeyPress}\r\n            getOptionLabel={(option) => option.name}\r\n            getOptionSelected={(option, value) => { return option.id === value.id }}\r\n            style={{ width: 250 }}\r\n            autoHighlight={true}\r\n            autoSelect={true}\r\n            size=\"small\"\r\n            renderInput={(params) => <TextField {...params} label=\"Enter creature name\" variant=\"outlined\" />}\r\n        />\r\n        <AddButton onClick={onAddButtonClick} />\r\n    </div>\r\n    );\r\n}\r\n\r\nfunction AddByLevelRange(params: {\r\n    demonCompendium: DemonCompendium,\r\n    onAddDemon: (demon: Models.Demon[]) => void\r\n}): JSX.Element {\r\n    const { demonCompendium, onAddDemon } = params;\r\n\r\n    const [minLvl, setMinLvl] = useState<number>(1);\r\n    const [maxLvl, setMaxLvl] = useState<number>(99);\r\n\r\n    function onAddButtonClick(): void {\r\n        const demons: Models.Demon[] = [];\r\n        for (const demon of demonCompendium.getDemonArray()) {\r\n            if (demon.lvl >= minLvl && demon.lvl <= maxLvl) {\r\n                demons.push(demon);\r\n            }\r\n        }\r\n        onAddDemon(demons);\r\n    }\r\n\r\n    function onKeyPress(event: KeyboardEvent<HTMLDivElement>): void {\r\n        const {key} = event;\r\n        const acceptedKeys: string[] = [\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"];\r\n        let keyIsAccepted: boolean = false;\r\n        for (const acceptedKey of acceptedKeys) {\r\n            if (key === acceptedKey) {\r\n                keyIsAccepted = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!keyIsAccepted) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n    }\r\n\r\n    function onChange(valueSetterFunc: Function, event: React.ChangeEvent<HTMLInputElement>): void {\r\n        const value: number | string = event.target.value;\r\n        const valueAsNumber = Number(value)\r\n        if (value === \"\" || (valueAsNumber >= 1 && valueAsNumber <= 99)) {\r\n            valueSetterFunc(event.target.value);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={styles.subAdderContainer}>\r\n            <div className={styles.lvlFieldsContainer}>\r\n                <TextField\r\n                    label=\"Min Lv\"\r\n                    style={{ width: \"122px\" }}\r\n                    type=\"number\"\r\n                    InputLabelProps={{\r\n                        shrink: true,\r\n                    }}\r\n                    variant=\"outlined\"\r\n                    value={minLvl}\r\n                    onChange={onChange.bind(undefined, setMinLvl)}\r\n                    onKeyPress={onKeyPress}\r\n                    size=\"small\"\r\n                />\r\n                <TextField\r\n                    label=\"Max Lv\"\r\n                    style={{ width: \"122px\" }}\r\n                    type=\"number\"\r\n                    InputLabelProps={{\r\n                        shrink: true,\r\n                    }}\r\n                    variant=\"outlined\"\r\n                    value={maxLvl}\r\n                    onKeyPress={onKeyPress}\r\n                    size=\"small\"\r\n                    onChange={onChange.bind(undefined, setMaxLvl)}\r\n                />\r\n            </div>\r\n            <AddButton onClick={onAddButtonClick} />\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction AddByPreset(params: {\r\n    demonCompendium: DemonCompendium,\r\n    onAddDemon: (demon: Models.Demon[]) => void\r\n}): JSX.Element {\r\n    const { demonCompendium, onAddDemon } = params;\r\n\r\n    type searchOption = { id: number, preset: Models.DemonsPreset };\r\n\r\n    let [selectedOption, setSelectedOption] = useState<searchOption | null>(null);\r\n\r\n    let searchOptions: searchOption[] = [];\r\n    let id: number = 1;\r\n    for (const preset of demonCompendium.getDemonPresets()) {\r\n        searchOptions.push({ id: id, preset: preset });\r\n        id++;\r\n    }\r\n\r\n    const onSearchBarSelectionChange: any = (event: React.ChangeEvent<HTMLInputElement>, selection: searchOption) => {\r\n        setSelectedOption(selection);\r\n    };\r\n\r\n    function onAddButtonClick() {\r\n        raiseOnAddDemonEvent();\r\n    }\r\n\r\n    function onKeyPress(event: React.KeyboardEvent<HTMLDivElement>) {\r\n        if (event.key === \"Enter\") {\r\n            raiseOnAddDemonEvent();\r\n        }\r\n    }\r\n\r\n    function raiseOnAddDemonEvent() {\r\n        if (selectedOption) {\r\n            onAddDemon(selectedOption.preset.demons);\r\n            setSelectedOption(null);\r\n        }\r\n    }\r\n\r\n    return (<div className={styles.subAdderContainer}>\r\n        <Autocomplete\r\n            value={selectedOption}\r\n            options={searchOptions}\r\n            onChange={onSearchBarSelectionChange}\r\n            onKeyPress={onKeyPress}\r\n            getOptionLabel={(option) => option.preset.caption}\r\n            getOptionSelected={(option, value) => { return option.id === value.id }}\r\n            style={{ width: 250 }}\r\n            autoHighlight={true}\r\n            autoSelect={true}\r\n            size=\"small\"\r\n            renderInput={(params) => <TextField {...params} label=\"Select a preset\" variant=\"outlined\" />}\r\n        />\r\n        <AddButton onClick={onAddButtonClick} />\r\n    </div>\r\n    );\r\n}\r\n\r\nfunction AddButton(params: {onClick?: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void}): JSX.Element {\r\n    const {onClick} = params;\r\n    return <Button variant=\"outlined\" onClick={onClick} className={styles.addDemonButton}><AddIcon />Add</Button>;\r\n}","import React from \"react\";\r\n\r\nimport * as Models from '../data/data-models';\r\n\r\nimport Card from '@material-ui/core/Card';\r\nimport CardContent from \"@material-ui/core/CardContent\";\r\nimport Divider from '@material-ui/core/Divider';\r\nimport Pagination from \"@material-ui/lab/Pagination\";\r\nimport Autocomplete from '@material-ui/lab/Autocomplete';\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nimport styles from './scss/recipes-table.module.scss';\r\n\r\nfunction renderDemonName(demon: Models.FusedDemon): JSX.Element {\r\n    if (demon.isFused()) {\r\n        return <React.Fragment>{demon.demon.name}</React.Fragment>;\r\n    } else {\r\n        return <span className={styles.baseIngredientName}>{demon.demon.name}</span>;\r\n    }\r\n}\r\n\r\nfunction renderRecipe(demon: Models.FusedDemon): JSX.Element {\r\n    let priorRecipes: JSX.Element = <React.Fragment />;\r\n    if (demon.ingredients) {\r\n        let curRecipe: JSX.Element = <React.Fragment />;\r\n        let isFirstLoop: boolean = true;\r\n        for (const ingDemon of demon.ingredients) {\r\n            priorRecipes = <React.Fragment>{priorRecipes}{renderRecipe(ingDemon)}</React.Fragment>;\r\n            const separator = isFirstLoop ? undefined : <React.Fragment> + </React.Fragment>;\r\n            curRecipe = <React.Fragment>{curRecipe}{separator}{renderDemonName(ingDemon)}</React.Fragment>\r\n            isFirstLoop = false;\r\n        }\r\n        const nameR = renderDemonName(demon);\r\n        return <React.Fragment>\r\n            {priorRecipes}\r\n            <Divider light />\r\n            <div className={styles.centerText}>{curRecipe}</div><div>&darr;</div><div>{nameR}</div>\r\n        </React.Fragment>;\r\n    }\r\n    return priorRecipes;\r\n}\r\n\r\nfunction DemonCard(props: {demon: Models.FusedDemon}): JSX.Element {\r\n    return <Card className={styles.recipeCard}>\r\n      <CardContent>\r\n          {renderRecipe(props.demon)}\r\n      </CardContent>\r\n    </Card>\r\n}\r\n\r\n//====================================================================================================\r\n\r\ntype FilterMap = { [demonId: number]: boolean};\r\ntype FilterOption = { demonId: number, demonName: string};\r\n\r\nfunction createFilterOptions(recipesAry: Models.FusedDemon[], currFilter: FilterOption[]): FilterOption[] {\r\n    const filterOptions: FilterOption[] = [];\r\n    let ingDemonsMap: { [demonId: number]: string} = {};\r\n    for (const fusedDemon of recipesAry) {\r\n        const ingDemons = fusedDemon.getBaseIngredientsDemons();\r\n        for (const ingDemon in ingDemons) {\r\n            ingDemonsMap[Number(ingDemon)] = ingDemons[ingDemon].name;\r\n        }\r\n    }\r\n    currFilter.map((filterOption: FilterOption, i) => ingDemonsMap[filterOption.demonId] = filterOption.demonName);\r\n    for (const ingDemonId in ingDemonsMap) {\r\n        filterOptions.push({ demonId: Number(ingDemonId), demonName: ingDemonsMap[ingDemonId]});\r\n    }\r\n    return filterOptions;\r\n}\r\n\r\nfunction filterRecipesAry(recipesAry: Models.FusedDemon[], filterMap: FilterMap): Models.FusedDemon[] {\r\n    const filteredAry: Models.FusedDemon[] = [];\r\n    for (const fusedDemon of recipesAry) {\r\n        const ingDemonsCount: { [demonId: number]: number } = fusedDemon.getBaseIngredientsCounts();\r\n        const filterCheckList = {...filterMap};\r\n        for (const ingDemonId in ingDemonsCount) {\r\n            delete filterCheckList[ingDemonId];\r\n        }\r\n        if (Object.keys(filterCheckList).length === 0) {\r\n            filteredAry.push(fusedDemon);\r\n        }\r\n    }\r\n    return filteredAry\r\n}\r\n\r\n\r\nexport default function RecipesTable(props: {demonId: number, recipesAry: Models.FusedDemon[]}): JSX.Element {\r\n    const pageSize: number = 100;\r\n    const [page, setPage] = React.useState<number>(1);\r\n    const [filter, setFilter] = React.useState<FilterOption[]>([]);\r\n    \r\n    const filteredRecipesAry = React.useMemo(()=>{\r\n        const filterMap: FilterMap = {};\r\n        filter.map((filterOption: FilterOption, i: number) => filterMap[filterOption.demonId] = true);\r\n        return filterRecipesAry(props.recipesAry, filterMap)\r\n    }, [props.recipesAry, filter]);\r\n\r\n    function handlePageChange(event: React.ChangeEvent<unknown>, page: number) {\r\n        setPage(page);\r\n    }\r\n    \r\n    function handleFilterChange(event: React.ChangeEvent<{}>, value: FilterOption[]) {\r\n        setPage(1);\r\n        setFilter(value);\r\n    }\r\n\r\n    const filterOptions = createFilterOptions(filteredRecipesAry, filter);\r\n\r\n    const maxPage: number = Math.ceil(filteredRecipesAry.length / pageSize);\r\n\r\n    return (\r\n    <div className={styles.componentContainer}>\r\n            <Autocomplete\r\n            multiple\r\n            className={styles.filterField}\r\n            size=\"small\"\r\n            onChange={handleFilterChange}\r\n            value={filter}\r\n            defaultValue={filter}\r\n            options={filterOptions}\r\n            getOptionLabel={(option) => option.demonName}\r\n            getOptionSelected={(option, value) => option.demonId === value.demonId}\r\n            autoHighlight={true}\r\n            filterSelectedOptions\r\n            renderInput={(params) => (<TextField {...params} variant=\"outlined\" label=\"Filter\" /> )}\r\n        />\r\n        <Pagination count={maxPage} page={page} onChange={handlePageChange} size=\"small\" className={styles.pagination} hidden={maxPage <= 1}/>\r\n        <div className={styles.recipeCardsContainer}>\r\n            {filteredRecipesAry\r\n            .filter((demon, i) => (i >= (page - 1) * pageSize) && (i < page * pageSize))\r\n            .map((demon, i) => <DemonCard key={i} demon={demon} />)}\r\n        </div>\r\n    </div>\r\n    );\r\n}","import React from 'react';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\n\r\nimport * as Models from './data/data-models';\r\nimport { DemonCompendium } from './data/demon-compendium';\r\nimport RecipesTable from './ui-components/recipes-table';\r\n\r\nimport styles from './demon-displayer.module.scss';\r\n\r\nexport default function DemonDisplayer(props: { demonCompendium: DemonCompendium, goBackUrlPath: string, fusionResults?: Models.FusionResults}): JSX.Element {\r\n    const demonIdStr = useParams<{ demonId: string }>().demonId;\r\n    const demonId = Number(demonIdStr);\r\n    const history = useHistory();\r\n\r\n    if (isNaN(demonId)) {\r\n        history.push(props.goBackUrlPath);\r\n        return <React.Fragment/>;\r\n    }\r\n    const demon = props.demonCompendium.getDemonById(demonId);\r\n    if (!demon) {\r\n        history.push(props.goBackUrlPath);\r\n        return <React.Fragment/>;\r\n    }\r\n    \r\n    let fusionResultsSection: JSX.Element | undefined = undefined;\r\n    if (props.fusionResults) {\r\n        let recipesAry: Models.FusedDemon[] | undefined = undefined;\r\n        for (const ingCountStr in props.fusionResults.data) {\r\n            const ingCount: number = Number(ingCountStr);\r\n            for (const id in props.fusionResults.data[ingCount]) {\r\n                if (Number(id) === demonId) {\r\n                    recipesAry = props.fusionResults.data[ingCount][id];\r\n                    break;\r\n                }\r\n            }\r\n            if (recipesAry) {\r\n                break;\r\n            }\r\n        }\r\n        if (recipesAry) {\r\n        fusionResultsSection = <React.Fragment>\r\n            <h2>Recipes</h2>\r\n            <RecipesTable demonId={demonId} recipesAry={recipesAry} />\r\n        </React.Fragment>;\r\n        }\r\n    }\r\n\r\n    return <div className={styles.componentContainer}>\r\n        <div className={styles.section}>\r\n            <h2>{demon.name}</h2>\r\n            <div><Label text=\"Race\" />{demon.race}<Label text=\"Level\" />{demon.lvl}</div>\r\n        </div>\r\n        <div className={styles.section}>\r\n            <h2>Stats</h2>\r\n            <div>{demon.stats.map((stat, i) => <React.Fragment key={i}><Label text={Models.Demon.statsName[i]} />{stat}</React.Fragment>)}</div>\r\n        </div>\r\n        <div className={styles.section}>{fusionResultsSection}</div>\r\n    </div>\r\n}\r\n\r\nfunction Label(props: { text: string }): JSX.Element {\r\n    return <span className={styles.label}>{props.text}</span>;\r\n}","// Imports for foundational functionalities\r\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\n// Imports for data\r\nimport * as Models from './data/data-models';\r\nimport { DemonCompendium } from './data/demon-compendium';\r\n\r\n// Imports for UI components\r\nimport Button from '@material-ui/core/Button';\r\nimport IngredientsTable from './ui-components/ingredients-table';\r\nimport ResultsTable from './ui-components/results-table';\r\nimport SettingsPanel, { UserSettings, SettingsPanelEventHandlers } from './ui-components/settings-panel';\r\nimport DemonAdder from './ui-components/demon-adder';\r\nimport Backdrop from '@material-ui/core/Backdrop';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\n\r\nimport ReplayIcon from '@material-ui/icons/Replay';\r\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport styles from './fusion-calculator.module.scss';\r\nimport { Route, Router, Switch, useHistory, useRouteMatch } from 'react-router-dom';\r\nimport DemonDisplayer from './demon-displayer';\r\n\r\nconst MAX_FUSION_INGREDIENT_HARD_CAP = 5;\r\n\r\nasync function calculateAllFusionCombinationsAsync(ingredients: Models.Ingredients, demonCompendium: DemonCompendium, settings: UserSettings, ingredientsSettings: Models.IngredientsSettings): Promise<Models.FusionResults> {\r\n  const promise = new Promise<Models.FusionResults>(function(resolver) {\r\n    setTimeout(function () {\r\n      resolver(calculateAllFusionCombinations(ingredients, demonCompendium, settings, ingredientsSettings));\r\n    }, 100);\r\n  });\r\n  return promise;\r\n}\r\n\r\nfunction calculateAllFusionCombinations(ingredients: Models.Ingredients, demonCompendium: DemonCompendium, userSettings: UserSettings, ingredientsSettings: Models.IngredientsSettings): Models.FusionResults {\r\n  const specialRecipes: Models.SpecialRecipes = demonCompendium.getSpecialRecipes();\r\n  const viableSpecialRecipes: Models.SpecialRecipes = {};\r\n  const maxIngredient: number = (userSettings.maxIngredient < MAX_FUSION_INGREDIENT_HARD_CAP) ? userSettings.maxIngredient : MAX_FUSION_INGREDIENT_HARD_CAP;\r\n  const fusionResults = new Models.FusionResults(maxIngredient);\r\n\r\n  for (const demonId in ingredients) {\r\n    const demon: Models.Demon | undefined = demonCompendium.getDemonById(Number(demonId));\r\n    if (!demon) { continue; }\r\n    const fusedDemon: Models.FusedDemon = new Models.FusedDemon(demon);\r\n    if (!fusionResults.data[1][demon.id]) {\r\n      fusionResults.data[1][demon.id] = [];\r\n    }\r\n    fusionResults.data[1][demon.id].push(fusedDemon);\r\n  }\r\n  updateViableSpecialRecipes(fusionResults, 1, specialRecipes, viableSpecialRecipes);\r\n\r\n  // Compute double fusions\r\n  for (let ingCountR = 2; ingCountR <= maxIngredient; ingCountR++) {\r\n    for (let ingCountA = ingCountR - 1; ingCountA >= (ingCountR / 2); ingCountA--) {\r\n      const ingCountB: number = ingCountR - ingCountA;\r\n      const speciesUsedAsA: { [id: number]: boolean } = {}; // id of the demon species that have already been used in the calculation as demon A\r\n      for (const idA in fusionResults.data[ingCountA]) {\r\n        if (fusionResults.data[ingCountA][idA].length === 0) { continue; }\r\n        const speciesA: Models.Demon = fusionResults.data[ingCountA][idA][0].demon;\r\n        for (const idB in fusionResults.data[ingCountB]) {\r\n          if (fusionResults.data[ingCountB][idB].length === 0) { continue; }\r\n          const speciesB: Models.Demon = fusionResults.data[ingCountB][idB][0].demon;\r\n\r\n          // skip calculating fusions that should have already been calculated since A+B produces the same results as B+A\r\n          if (speciesUsedAsA[speciesB.id]) { continue; }\r\n\r\n          const speciesR: Models.Demon | undefined = demonCompendium.fuseDemons(speciesA, speciesB);\r\n          if (!speciesR) { continue; }\r\n          if (!filterDemonsAfterSpeciesFusion(fusionResults, userSettings, speciesR, ingCountR, [speciesA, speciesB])) { continue; }\r\n\r\n          const resultingFusedDemons: Models.FusedDemon[] = crissCrossFusedDemons(speciesR, ingredientsSettings, fusionResults.data[ingCountA][idA], fusionResults.data[ingCountB][idB]);\r\n          fusionResults.addFusedDemonsOfSameSpecies(resultingFusedDemons);\r\n        }\r\n        speciesUsedAsA[speciesA.id] = true;\r\n      }\r\n    }\r\n\r\n    // Compute triple fusions\r\n    if (userSettings.useTripleFusion) {\r\n      calculateTripleFusionCombinations(demonCompendium, userSettings, ingredientsSettings, fusionResults, ingCountR);\r\n    }\r\n\r\n    // Compute special recipe fusions\r\n    calculateSpecialRecipeFusion(demonCompendium, userSettings, ingredientsSettings, fusionResults, ingCountR, viableSpecialRecipes);\r\n\r\n    // Update viable special recipes\r\n    updateViableSpecialRecipes(fusionResults, ingCountR, specialRecipes, viableSpecialRecipes);\r\n  }\r\n\r\n  // At this point, we're completely finished with all fusion combinations\r\n  // Re-traverse through all of the results and purge fusions that don't satisfy various constraints/settings\r\n  const mustUseDemons: Models.MustUseDemonsMap = prepareIngredientsSettingsForFinalFilter(ingredientsSettings, ingredients);\r\n  let filterFunction = filterDemonsAfterCalculation.bind(undefined, mustUseDemons);\r\n  fusionResults.filter(filterFunction);\r\n\r\n  return fusionResults;\r\n}\r\n\r\nfunction updateViableSpecialRecipes(fusionResults: Models.FusionResults, ingCountNodeToUpdate: number, specialRecipes: Models.SpecialRecipes, viableSpecialRecipes: Models.SpecialRecipes) {\r\n  for (const demonId in fusionResults.data[ingCountNodeToUpdate]) {\r\n    for (let recipeIngCount = 2; recipeIngCount <= fusionResults.getMaxIngredient(); recipeIngCount++) {\r\n      if (!specialRecipes[recipeIngCount]) { continue; }\r\n      for (const recipe of specialRecipes[recipeIngCount]) {\r\n        const registrationSuccessful: boolean = recipe.registerIngredient(Number(demonId), ingCountNodeToUpdate);\r\n        if (registrationSuccessful && recipe.isViable()) {\r\n          const recipeCost: number = recipe.totalBaseIngredientsCost();\r\n          if (!viableSpecialRecipes[recipeCost]) {\r\n            viableSpecialRecipes[recipeCost] = [];\r\n          }\r\n          viableSpecialRecipes[recipeCost].push(recipe);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction calculateTripleFusionCombinations(demonCompendium: DemonCompendium, userSettings: UserSettings, ingredientsSettings: Models.IngredientsSettings, fusionResults: Models.FusionResults, ingCountR: number): void {\r\n  let ingCounts: number[] = [];\r\n  while (getNextCombinationTuple(ingCounts, 3, ingCountR)) {\r\n    const [ingCountA, ingCountB, ingCountC] = ingCounts;\r\n    const alreadyCalculatedAsA: { [id: number]: boolean } = {};\r\n    for (const idA in fusionResults.data[ingCountA]) {\r\n      if (fusionResults.data[ingCountA][idA].length === 0) { continue; }\r\n      const speciesA: Models.Demon = fusionResults.data[ingCountA][idA][0].demon;\r\n\r\n      const alreadyCalculatedAsB: { [id: number]: boolean } = {};\r\n      for (const idB in fusionResults.data[ingCountB]) {\r\n        if (alreadyCalculatedAsA[Number(idB)]) { continue; }\r\n        if (fusionResults.data[ingCountB][idB].length === 0) { continue; }\r\n        const speciesB: Models.Demon = fusionResults.data[ingCountB][idB][0].demon;\r\n\r\n        for (const idC in fusionResults.data[ingCountC]) {\r\n          if (alreadyCalculatedAsA[Number(idC)]) { continue; }\r\n          if (alreadyCalculatedAsB[Number(idC)]) { continue; }\r\n          if (fusionResults.data[ingCountC][idC].length === 0) { continue; }\r\n          const speciesC: Models.Demon = fusionResults.data[ingCountC][idC][0].demon;\r\n          const speciesR: Models.Demon | undefined = demonCompendium.tripleFuseDemons(speciesA, speciesB, speciesC);\r\n          if (!speciesR) { continue; }\r\n          if (!filterDemonsAfterSpeciesFusion(fusionResults, userSettings, speciesR, ingCountR, [speciesA, speciesB, speciesC])) { continue; }\r\n          const resultFusedDemons: Models.FusedDemon[] = crissCrossFusedDemons(speciesR, ingredientsSettings, fusionResults.data[ingCountA][idA], fusionResults.data[ingCountB][idB], fusionResults.data[ingCountC][idC]);\r\n          fusionResults.addFusedDemonsOfSameSpecies(resultFusedDemons);\r\n        }\r\n        alreadyCalculatedAsB[speciesB.id] = true;\r\n      }\r\n      alreadyCalculatedAsA[speciesA.id] = true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction calculateSpecialRecipeFusion(demonCompendium: DemonCompendium, userSettings: UserSettings, ingredientsSettings: Models.IngredientsSettings, fusionResults: Models.FusionResults, ingCountR: number, viableSpecialRecipes: Models.SpecialRecipes): void {\r\n  const currSpecialRecipes: Models.Recipe[] | undefined = viableSpecialRecipes[ingCountR];\r\n  if (!currSpecialRecipes) { return; }\r\n  for (const specialRecipe of currSpecialRecipes) {\r\n    const speciesR: Models.Demon | undefined = demonCompendium.getDemonById(specialRecipe.resultId);\r\n    if (!speciesR) { continue; }\r\n\r\n    const ingredientsSpecies: Models.Demon[] = [];\r\n    const ingredientsFusedDemons: Models.FusedDemon[][] = [];\r\n    let missingIngredient: boolean = false;\r\n    for (const ingredientId in specialRecipe.ingredients) {\r\n      const ingredientSpecies: Models.Demon | undefined = demonCompendium.getDemonById(Number(ingredientId));\r\n      if (!ingredientSpecies) {\r\n        missingIngredient = true;\r\n        break;\r\n      }\r\n      ingredientsSpecies.push(ingredientSpecies);\r\n      const ingredientCost: number = specialRecipe.ingredients[ingredientId];\r\n      ingredientsFusedDemons.push(fusionResults.data[ingredientCost][ingredientSpecies.id]);\r\n    }\r\n    if (missingIngredient) { continue; }\r\n    if (!filterDemonsAfterSpeciesFusion(fusionResults, userSettings, speciesR, ingCountR, ingredientsSpecies)) { continue; }\r\n\r\n    const resultingFusedDemons: Models.FusedDemon[] = crissCrossFusedDemons(speciesR, ingredientsSettings, ...ingredientsFusedDemons);\r\n    fusionResults.addFusedDemonsOfSameSpecies(resultingFusedDemons);\r\n  }\r\n}\r\n\r\nfunction getNextCombinationTuple(currentTuple: number[], tupleSize: number, sumRequirement: number): boolean {\r\n  if (sumRequirement < tupleSize) { return false; }\r\n  if (currentTuple.length > tupleSize) { return false; }\r\n\r\n  // Initialize the tuple if given an empty tuple\r\n  if (currentTuple.length === 0) { \r\n    currentTuple[0] = sumRequirement - tupleSize + 1;\r\n    for (let i = 1; i < tupleSize; i++) {\r\n      currentTuple[i] = 1;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // If not given an empty tuple, compute the next tuple\r\n  for (let i = currentTuple.length - 2; i >= 0; i--) {\r\n    const j: number = i + 1;\r\n    if (currentTuple[i] - currentTuple[j] >= 2) {\r\n      currentTuple[i] = currentTuple[i] - 1;\r\n      currentTuple[j] = currentTuple[j] + 1;\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction filterDemonsAfterSpeciesFusion(fusionResults: Models.FusionResults, settings: UserSettings, speciesR: Models.Demon, ingCountR: number, speciesIngs: Models.Demon[]): boolean {\r\n  // throw out the resulting species if we knew how to make it with fewer ingredients\r\n  let canBeMadeWithLessIngredient: boolean = false;\r\n  for (let sizeCheck = ingCountR - 1; sizeCheck >= 1; sizeCheck--) {\r\n    if (fusionResults.data[sizeCheck][speciesR.id]) {\r\n      canBeMadeWithLessIngredient = true;\r\n      break;\r\n    }\r\n  }\r\n  if (canBeMadeWithLessIngredient) { return false; }\r\n\r\n  if (speciesR.lvl > settings.charLvl) { return false; }\r\n\r\n  // if this is the final round of fusions, throw out fusions that produce demons that are lower level \r\n  if (ingCountR === settings.maxIngredient) {\r\n    for (const speciesIng of speciesIngs) {\r\n      if (speciesR.lvl < speciesIng.lvl) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction filterDemonsAfterCrissCross(ingSettings: Models.IngredientsSettings, demon: Models.FusedDemon): boolean {\r\n  const baseIngCount = demon.getBaseIngredientsCounts();\r\n  for (const id in baseIngCount) {\r\n    if (baseIngCount[id] > 1 && !ingSettings[id].multipleUse) { return false; }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction filterDemonsAfterCalculation(mustUseDemons: Models.MustUseDemonsMap, demon: Models.FusedDemon): boolean {\r\n  if (demon.isWeakerThanBaseIngredients()) { return false; }\r\n  const myMustUseDemons = {...mustUseDemons};\r\n  const demonBaseIngCount = demon.getBaseIngredientsCounts();\r\n  for (const demonId in demonBaseIngCount) {\r\n    delete myMustUseDemons[demonId];\r\n  }\r\n  if (Object.keys(myMustUseDemons).length > 0) { return false; }\r\n  return true;\r\n}\r\n\r\nfunction prepareIngredientsSettingsForFinalFilter(ingSettings: Models.IngredientsSettings, ingredients: Models.Ingredients): Models.MustUseDemonsMap {\r\n  const mustUseDemons: Models.MustUseDemonsMap = {};\r\n  for (const id in ingredients) {\r\n    if (ingSettings[id].mustUse) { mustUseDemons[id] = true };\r\n  }\r\n  return mustUseDemons;\r\n}\r\n\r\nfunction crissCrossFusedDemons(resultSpecies: Models.Demon, ingredientsSettings: Models.IngredientsSettings, ...ingredients: Models.FusedDemon[][]): Models.FusedDemon[] {\r\n  const indeces: number[] = [];\r\n  const ret: Models.FusedDemon[] = [];\r\n  for (let i = 0; i < ingredients.length; i++) {\r\n    indeces.push(0);\r\n  }\r\n  while (true) {\r\n    const fusedDemonIngredientsHistory: Models.FusedDemon[] = [];\r\n    for (let i = 0; i < ingredients.length; i++) {\r\n      fusedDemonIngredientsHistory.push(ingredients[i][indeces[i]]);\r\n    }\r\n    ret.push(new Models.FusedDemon(resultSpecies, fusedDemonIngredientsHistory));\r\n\r\n    // Increment the indeces\r\n    let hasCarry: boolean = true;\r\n    for (let i = indeces.length - 1; i >= 0; i--) {\r\n      let index: number = indeces[i];\r\n      if (hasCarry) { index = index + 1; hasCarry = false; }\r\n      if (index >= ingredients[i].length) { index = 0; hasCarry = true; }\r\n      indeces[i] = index;\r\n      if (!hasCarry) { break; }\r\n    }\r\n    if (hasCarry) { break; }\r\n  }\r\n  \r\n  return ret.filter(filterDemonsAfterCrissCross.bind(undefined, ingredientsSettings));;\r\n}\r\n\r\n//====================================================================================================\r\n\r\nfunction initializeUserSettings(demonCompendium: DemonCompendium): UserSettings {\r\n  const settings = new UserSettings();\r\n  settings.useTripleFusion = demonCompendium.enableTripleFusion;\r\n  settings.useTripleFusionSettingIsVisible = demonCompendium.enableTripleFusion;\r\n  return settings;\r\n}\r\n\r\nexport default function FusionCalculator(props: { demonCompendium: DemonCompendium }): JSX.Element {\r\n  const { demonCompendium } = props;\r\n\r\n  const [ingredients, setIngredients] = useState<Models.Ingredients>({});\r\n  let [fusionResults, setFusionResults] = useState<Models.FusionResults>(new Models.FusionResults());\r\n  const [fusionResultsPromise, setFusionResultsPromise] = useState<Promise<Models.FusionResults> | undefined>(undefined);\r\n  let [resetterKey, setResetterKey] = useState<number>(1); // This key is meant to be used to reset components. Changes to this key will trigger components to reset.\r\n  const history = useHistory();\r\n  const routeMatcher = useRouteMatch();\r\n\r\n  let [nonRenderingStates] = useState<[UserSettings, Models.IngredientsSettings]>([initializeUserSettings(demonCompendium), {}]);\r\n  const settings = nonRenderingStates[0];\r\n  const ingredientsSettings = nonRenderingStates[1];\r\n  const settingsPanelEventHandlers: SettingsPanelEventHandlers = {};\r\n  const refResultsTable = useRef<HTMLHeadingElement>(null);\r\n\r\n  useEffect(()=>{\r\n    let isMounted: boolean = true;\r\n\r\n    if (fusionResultsPromise) {\r\n      fusionResultsPromise.then((fr)=>{\r\n        if (isMounted) {\r\n          setFusionResults(fr);\r\n          setFusionResultsPromise(undefined);\r\n          if (fr.hasFusionResult()) {\r\n            refResultsTable.current?.scrollIntoView({ behavior: \"smooth\" });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    return ()=>{ isMounted = false; }\r\n  }, [fusionResults, fusionResultsPromise]);\r\n\r\n  const removeDemonFromIngredientsHandler = useCallback(function (demonId: number): void {\r\n    const newIngredients = { ...ingredients };\r\n    delete newIngredients[demonId];\r\n    setIngredients(newIngredients);\r\n  }, [ingredients]);\r\n\r\n  function addDemonToIngredientsHandler(demons: Models.Demon[]): void {\r\n    const newIngredients = { ...ingredients };\r\n    for (const demon of demons) {\r\n      newIngredients[demon.id] = true;\r\n    }\r\n    setIngredients(newIngredients);\r\n  };\r\n\r\n  function calculateButtonHandler(): void {\r\n    setFusionResultsPromise(calculateAllFusionCombinationsAsync(ingredients, demonCompendium, settings, ingredientsSettings));\r\n  }\r\n\r\n  function settingsButtonHandler(): void {\r\n    if (settingsPanelEventHandlers.toggleVisibility) {\r\n      settingsPanelEventHandlers.toggleVisibility();\r\n    }\r\n  }\r\n\r\n  function resetButtonHandler(): void {\r\n    const newIngredients = {};\r\n    setIngredients(newIngredients);\r\n    for (const key in ingredientsSettings) {\r\n      delete ingredientsSettings[key];\r\n    }\r\n    \r\n    setFusionResults(new Models.FusionResults());\r\n\r\n    setResetterKey((resetterKey + 1) % 2);\r\n  }\r\n\r\n  function openDemonRecipesHandler(demonId: number) {\r\n    history.push(`${routeMatcher.url}/creature/${demonId}`);\r\n  }\r\n  \r\n  return (\r\n    <Router history={history}>\r\n      <Switch>\r\n        <Route path={`${routeMatcher.path}/creature/:demonId`}>\r\n          <DemonDisplayer demonCompendium={demonCompendium} goBackUrlPath={routeMatcher.url} fusionResults={fusionResults} />\r\n        </Route>\r\n        <Route path={`${routeMatcher.path}/`}>\r\n\r\n          <div className={styles.fusionCalculator + (fusionResultsPromise ? \" \" + styles.loading : \"\")}>\r\n            <div className={styles.section}>\r\n              <h2>Add Creatures to Use as Fusion Ingredients</h2>\r\n              <div className={styles.addDemonsAndButtonsRowContainer}>\r\n                <DemonAdder key={resetterKey} demonCompendium={demonCompendium} onAddDemon={addDemonToIngredientsHandler} />\r\n                <div className={styles.buttonsRow}>\r\n                  <Button className={styles.calculateButton} variant=\"outlined\" onClick={calculateButtonHandler} disabled={Object.keys(ingredients).length === 0} ><PlayArrowIcon />Calculate</Button>\r\n                  <Button className={styles.settingsButton} variant=\"outlined\" onClick={settingsButtonHandler}><SettingsIcon /></Button>\r\n                  <Button className={styles.resetButton} variant=\"outlined\" onClick={resetButtonHandler}><ReplayIcon />Reset</Button>\r\n                </div>\r\n              </div>\r\n              <SettingsPanel key={resetterKey} settings={settings} eventHandlers={settingsPanelEventHandlers} />\r\n            </div>\r\n            <div className={styles.section} hidden={Object.keys(ingredients).length === 0}>\r\n              <h2>Fusion Ingredients</h2>\r\n              <IngredientsTable\r\n                demonCompendium={demonCompendium}\r\n                ingredients={ingredients}\r\n                ingredientsSettings={ingredientsSettings}\r\n                onRemoveIngredient={removeDemonFromIngredientsHandler} />\r\n            </div>\r\n            <div className={styles.section} hidden={!fusionResults.hasFusionResult()}>\r\n              <h2>Results</h2>\r\n              <div ref={refResultsTable}>\r\n                <ResultsTable fusionResults={fusionResults} onOpenDemonRecipes={openDemonRecipesHandler} />\r\n              </div>\r\n            </div>\r\n            \r\n            <Backdrop open={fusionResultsPromise !== undefined} hidden={fusionResultsPromise === undefined}>\r\n              <CircularProgress color=\"inherit\" />\r\n            </Backdrop>\r\n          </div>\r\n\r\n        </Route>\r\n      </Switch>\r\n    </Router>\r\n  );\r\n}","import React from 'react';\r\nimport {useHistory, useParams} from 'react-router-dom';\r\n\r\nimport { ThemeProvider, createMuiTheme } from '@material-ui/core/styles'\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\n\r\nimport { DemonCompendium } from './data/demon-compendium';\r\nimport FusionCalculator from './fusion-calculator';\r\n\r\nimport './App.scss';\r\nimport { Tab, Tabs } from '@material-ui/core';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    type: \"dark\",\r\n  },\r\n  typography: {\r\n    fontFamily: \"sans-serif\"\r\n  }\r\n});\r\n\r\nfunction loadDesu2DemonCompendium(callback: (demonCompendium: DemonCompendium) => void): void {\r\n  const demonJsonPromise = import(\"./data/desu2/demons.json\").then(importedJson => importedJson.default);\r\n  const fusionChartJsonPromise = import(\"./data/desu2/fusion-chart.json\").then(importedJson => importedJson.default);\r\n  const settingsJsonPromise = import(\"./data/desu2/fusion-settings.json\").then(importedJson => importedJson.default);\r\n  const presetJsonPromise = import(\"./data/desu2/presets.json\").then(importedJson => importedJson.default);\r\n  Promise.all([demonJsonPromise, fusionChartJsonPromise, settingsJsonPromise, presetJsonPromise]).then(loadedJsons => {\r\n    const newDemonCompendium = new DemonCompendium(loadedJsons[0], loadedJsons[1], loadedJsons[2], loadedJsons[3]);\r\n    callback(newDemonCompendium);\r\n  })\r\n}\r\n\r\nfunction loadPersona4GoldenDemonCompendium(setLoadedCompendiumCallback: (demonCompendium: DemonCompendium) => void): void {\r\n  const demonJsonPromise = import(\"./data/p4g/demons.json\").then(importedJson => importedJson.default);\r\n  const fusionChartJsonPromise = import(\"./data/p4g/fusion-chart.json\").then(importedJson => importedJson.default);\r\n  const settingsJsonPromise = import(\"./data/p4g/fusion-settings.json\").then(importedJson => importedJson.default);\r\n  Promise.all([demonJsonPromise, fusionChartJsonPromise, settingsJsonPromise]).then(loadedJsons => {\r\n    const newDemonCompendium = new DemonCompendium(loadedJsons[0], loadedJsons[1], loadedJsons[2]);\r\n    setLoadedCompendiumCallback(newDemonCompendium);\r\n  })\r\n}\r\n\r\nfunction loadPersona5RoyalDemonCompendium(setLoadedCompendiumCallback: (demonCompendium: DemonCompendium) => void): void {\r\n  const demonJsonPromise = import(\"./data/p5r/demons.json\").then(importedJson => importedJson.default);\r\n  const fusionChartJsonPromise = import(\"./data/p5r/fusion-chart.json\").then(importedJson => importedJson.default);\r\n  const settingsJsonPromise = import(\"./data/p5r/fusion-settings.json\").then(importedJson => importedJson.default);\r\n  Promise.all([demonJsonPromise, fusionChartJsonPromise, settingsJsonPromise]).then(loadedJsons => {\r\n    const newDemonCompendium = new DemonCompendium(loadedJsons[0], loadedJsons[1], loadedJsons[2]);\r\n    setLoadedCompendiumCallback(newDemonCompendium);\r\n  })\r\n}\r\n\r\nexport enum Game {\r\n  person4Golden = 0,\r\n  persona5Royal = 1,\r\n  devilSurvivor2 = 2\r\n}\r\n\r\nfunction loadGameData(game: Game, setLoadedCompendiumCallback: (demonCompendium: DemonCompendium) => void): void {\r\n  switch(game) {\r\n    case Game.person4Golden:\r\n      loadPersona4GoldenDemonCompendium(setLoadedCompendiumCallback);\r\n      break;\r\n    case Game.persona5Royal:\r\n      loadPersona5RoyalDemonCompendium(setLoadedCompendiumCallback);\r\n      break;\r\n    case Game.devilSurvivor2:\r\n      loadDesu2DemonCompendium(setLoadedCompendiumCallback);\r\n      break;\r\n    default:\r\n      loadPersona4GoldenDemonCompendium(setLoadedCompendiumCallback);\r\n      break;\r\n  }\r\n}\r\n\r\nconst urlParamToGameMap: { [gameStr: string]: Game } = {\r\n  p4g: Game.person4Golden,\r\n  p5r: Game.persona5Royal,\r\n  desu2: Game.devilSurvivor2\r\n}\r\n\r\nfunction getGameUrlPath(game: Game): string | undefined {\r\n  for (const gameStrCode in urlParamToGameMap) {\r\n    if (urlParamToGameMap[gameStrCode] === game) {\r\n      return gameStrCode;\r\n    }\r\n  }\r\n}\r\n\r\nexport default function App(): JSX.Element {\r\n  const urlParams = useParams<{gameStrCode: string}>();\r\n  const [demonCompendium, setDemonCompendium] = React.useState<DemonCompendium | undefined>(undefined);\r\n  const [currentGame, setCurrentGame] = React.useState<Game>(Game.person4Golden);\r\n\r\n  React.useEffect(()=>{\r\n      loadGameData(currentGame, setDemonCompendium);\r\n  }, [currentGame]);\r\n  \r\n  const history = useHistory();\r\n  \r\n  const changeGameTabHandler = (event: React.ChangeEvent<{}> | undefined, gameId: Game) => {\r\n    if (gameId !== currentGame) {\r\n      setDemonCompendium(undefined);\r\n    }\r\n    history.push(\"/megaten-fusion-calculator/\" + getGameUrlPath(gameId));\r\n  };\r\n\r\n  const gameFromUrlParam: Game | undefined = urlParamToGameMap[urlParams.gameStrCode];\r\n  if (gameFromUrlParam === undefined) {\r\n    changeGameTabHandler(undefined, Game.person4Golden);\r\n    return <React.Fragment />\r\n  } else if (gameFromUrlParam !== currentGame) {\r\n    setCurrentGame(gameFromUrlParam);\r\n    return <React.Fragment />\r\n  }\r\n\r\n  if (!demonCompendium) {\r\n    return <React.Fragment />\r\n  }\r\n  \r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      <div className=\"myApp\">\r\n\r\n        <header>\r\n          <h1>MegaTen Fusion Calculator</h1>\r\n        </header>\r\n        <Tabs value={currentGame} onChange={changeGameTabHandler}>\r\n          <Tab label=\"Persona 4 Golden\" />\r\n          <Tab label=\"Persona 5 Royal\" />\r\n          <Tab label=\"Devil Survivor 2\" />\r\n        </Tabs>\r\n\r\n        <div className=\"appBody\">\r\n          <FusionCalculator demonCompendium={demonCompendium} />\r\n        </div>\r\n\r\n      </div>\r\n    </ThemeProvider>);\r\n}","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {\r\n  Switch,\r\n  Route,\r\n  Router,\r\n  Redirect\r\n} from 'react-router-dom';\r\nimport { createBrowserHistory } from 'history';\r\n\r\nimport App from './App';\r\n\r\nReactDOM.render(<GitHubPageRedirect />,\r\n  document.getElementById('gitHubPageRedirector'));\r\n\r\nconst history = createBrowserHistory();\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Router history={history}>\r\n      <Switch>\r\n        <Route path=\"/megaten-fusion-calculator/:gameStrCode?\">\r\n          <App/>\r\n        </Route>\r\n        <Route path=\"/\">\r\n          <Redirect to=\"/megaten-fusion-calculator/\" />\r\n        </Route>\r\n      </Switch>\r\n    </Router>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nfunction GitHubPageRedirect(): JSX.Element {\r\n  // Single Page Apps for GitHub Pages\r\n  // MIT License\r\n  // https://github.com/rafgraph/spa-github-pages\r\n  // This script checks to see if a redirect is present in the query string,\r\n  // converts it back into the correct url and adds it to the\r\n  // browser's history using window.history.replaceState(...),\r\n  // which won't cause the browser to attempt to load the new url.\r\n  // When the single page app is loaded further down in this file,\r\n  // the correct url will be waiting in the browser's history for\r\n  // the single page app to route accordingly.\r\n  (function(loc) {\r\n    if (loc.search[1] === '/' ) {\r\n      var decoded = loc.search.slice(1).split('&').map(function(s) { \r\n        return s.replace(/~and~/g, '&')\r\n      }).join('?');\r\n      window.history.replaceState(null, \"\",\r\n          loc.pathname.slice(0, -1) + decoded + loc.hash\r\n      );\r\n    }\r\n  }(window.location))\r\n  return <React.Fragment />\r\n}\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dataTable\":\"results-table_dataTable__A-itk\",\"nameColumn\":\"results-table_nameColumn__1KY1B\",\"lvlColumn\":\"results-table_lvlColumn__HV-p9\",\"raceColumn\":\"results-table_raceColumn__34cc6\",\"statColumn\":\"results-table_statColumn__q0cSq\",\"ingredientsColumn\":\"results-table_ingredientsColumn__2fTxK\",\"recipeButton\":\"results-table_recipeButton__10uJR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fusionCalculator\":\"fusion-calculator_fusionCalculator__2J5hs\",\"loading\":\"fusion-calculator_loading__ubbhO\",\"addDemonsAndButtonsRowContainer\":\"fusion-calculator_addDemonsAndButtonsRowContainer__1tSWj\",\"buttonsRow\":\"fusion-calculator_buttonsRow__2KZwX\",\"calculateButton\":\"fusion-calculator_calculateButton__2Zzjp\",\"section\":\"fusion-calculator_section__3ddRG\",\"shining\":\"fusion-calculator_shining__3w-Ba\",\"settingsButton\":\"fusion-calculator_settingsButton__1k3XF\",\"resetButton\":\"fusion-calculator_resetButton__1lLjg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dataTable\":\"ingredients-table_dataTable__GZbXf\",\"checkBox\":\"ingredients-table_checkBox__1Fu5e\",\"nameColumnHeader\":\"ingredients-table_nameColumnHeader__2kahT\",\"raceColumnHeader\":\"ingredients-table_raceColumnHeader__2DpCq\",\"removeDemonButton\":\"ingredients-table_removeDemonButton__2YSJG\",\"removeDemonButtonIcon\":\"ingredients-table_removeDemonButtonIcon__24jqI\",\"warningIcon\":\"ingredients-table_warningIcon__10iol\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"componentContainer\":\"recipes-table_componentContainer__2K78a\",\"filterField\":\"recipes-table_filterField__23cwe\",\"pagination\":\"recipes-table_pagination__1JGBy\",\"recipeCardsContainer\":\"recipes-table_recipeCardsContainer__1KU_Y\",\"recipeCard\":\"recipes-table_recipeCard__2mmoP\",\"baseIngredientName\":\"recipes-table_baseIngredientName__271KH\",\"centerText\":\"recipes-table_centerText__1oz1X\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"settingsPanel\":\"settings-panel_settingsPanel__o_2-c\",\"paper\":\"settings-panel_paper__2oSLK\",\"settingsLine\":\"settings-panel_settingsLine__29yJK\",\"numberSettings\":\"settings-panel_numberSettings__26TYc\",\"numberFieldLabel\":\"settings-panel_numberFieldLabel__1noYu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"demonAdderContainer\":\"ui-components_demonAdderContainer__2QEF3\",\"subAdderContainer\":\"ui-components_subAdderContainer__3NiEF\",\"lvlFieldsContainer\":\"ui-components_lvlFieldsContainer__1FKd2\",\"addDemonButton\":\"ui-components_addDemonButton__3bNNG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"componentContainer\":\"demon-displayer_componentContainer__3im4C\",\"section\":\"demon-displayer_section__1VpPW\",\"label\":\"demon-displayer_label__3kZka\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"paperContainer\":\"data-table_paperContainer__12gHU\",\"tableContainer\":\"data-table_tableContainer__1d2OA\",\"header\":\"data-table_header__1XSQ_\",\"tableBody\":\"data-table_tableBody__3Zez6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"warningBanner\":\"minor-ui-components_warningBanner__2TK13\",\"icon\":\"minor-ui-components_icon__2Mvtn\"};"],"sourceRoot":""}